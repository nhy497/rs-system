<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å»ºç«‹å¸³æˆ¶æ¸¬è©¦å·¥å…·</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      display: flex;
      min-height: 100vh;
      background: #f5f7fa;
      font-family: 'Noto Sans TC', sans-serif;
    }
    
    .container {
      display: flex;
      width: 100%;
      gap: 2rem;
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .panel {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .panel h2 {
      margin-bottom: 1.5rem;
      color: #1e293b;
      font-size: 1.3rem;
      border-bottom: 2px solid #667eea;
      padding-bottom: 0.75rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 500;
      color: #1e293b;
      font-size: 0.9rem;
    }
    
    .form-group input {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 0.9rem;
      font-family: inherit;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .button-group {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    button {
      flex: 1;
      padding: 0.7rem;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #764ba2;
    }
    
    button.secondary {
      background: #64748b;
    }
    
    button.secondary:hover {
      background: #475569;
    }
    
    .output {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
      font-size: 0.85rem;
      font-family: 'Courier New', monospace;
      max-height: 300px;
      overflow-y: auto;
      color: #333;
    }
    
    .output p {
      margin: 0.3rem 0;
      word-break: break-all;
    }
    
    .status-box {
      background: #e0f2fe;
      border-left: 4px solid #0284c7;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
    }
    
    .status-box.success {
      background: #d1fae5;
      border-left-color: #059669;
    }
    
    .status-box.error {
      background: #fee2e2;
      border-left-color: #dc2626;
    }
    
    .status-box.warning {
      background: #fef3c7;
      border-left-color: #d97706;
    }
    
    .iframe-container {
      flex: 1;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .iframe-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .table-wrapper {
      overflow-x: auto;
      margin-top: 1rem;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }
    
    th {
      background: #f1f5f9;
      padding: 0.6rem;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
      color: #1e293b;
    }
    
    td {
      padding: 0.6rem;
      border-bottom: 1px solid #e2e8f0;
      color: #475569;
    }
    
    tr:hover {
      background: #f8fafc;
    }
    
    .test-flow {
      background: #ecfdf5;
      border: 1px solid #d1fae5;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .test-flow h3 {
      color: #059669;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    
    .test-flow ol {
      margin-left: 1.5rem;
      color: #047857;
      font-size: 0.9rem;
    }
    
    .test-flow li {
      margin-bottom: 0.4rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦å´ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="panel">
      <h2>ğŸ”§ å¸³æˆ¶ç®¡ç†å·¥å…·</h2>
      
      <!-- å¿«é€Ÿç‹€æ…‹ -->
      <div class="status-box" id="statusBox">
        â„¹ï¸ ç³»çµ±å·²å°±ç·’ï¼Œæº–å‚™æ¸¬è©¦
      </div>
      
      <!-- å»ºç«‹æ–°å¸³æˆ¶ -->
      <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="color: #1e293b; margin-bottom: 1rem;">ğŸ“ å»ºç«‹æ–°å¸³æˆ¶</h3>
        
        <div class="form-group">
          <label for="newUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="newUsername" placeholder="ä¾‹å¦‚ï¼šjohn_doe" value="testuser1">
        </div>
        
        <div class="form-group">
          <label for="newPassword">å¯†ç¢¼</label>
          <input type="password" id="newPassword" placeholder="æœ€å°‘4å€‹å­—ç¬¦" value="test1234">
        </div>
        
        <div class="form-group">
          <label for="newEmail">é›»éƒµ</label>
          <input type="email" id="newEmail" placeholder="ä¾‹å¦‚ï¼šjohn@example.com" value="test@example.com">
        </div>
        
        <div class="button-group">
          <button onclick="createAccount()">âœ… å»ºç«‹å¸³æˆ¶</button>
          <button class="secondary" onclick="clearSignupForm()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>
      </div>
      
      <!-- ç™»å…¥æ¸¬è©¦ -->
      <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="color: #1e293b; margin-bottom: 1rem;">ğŸ”“ æ¸¬è©¦ç™»å…¥</h3>
        
        <div class="form-group">
          <label for="loginUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="loginUsername" placeholder="è¼¸å…¥ä½¿ç”¨è€…åç¨±" value="testuser1">
        </div>
        
        <div class="form-group">
          <label for="loginPassword">å¯†ç¢¼</label>
          <input type="password" id="loginPassword" placeholder="è¼¸å…¥å¯†ç¢¼" value="test1234">
        </div>
        
        <div class="button-group">
          <button onclick="testLogin()">ğŸ”“ æ¸¬è©¦ç™»å…¥</button>
          <button class="secondary" onclick="clearLoginForm()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>
      </div>
      
      <!-- localStorage æ“ä½œ -->
      <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
        <h3 style="color: #1e293b; margin-bottom: 1rem;">ğŸ’¾ localStorage ç®¡ç†</h3>
        
        <div class="button-group" style="flex-direction: column; gap: 0.5rem;">
          <button onclick="showAllUsers()">ğŸ“Š æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶</button>
          <button onclick="showCurrentUser()">ğŸ‘¤ æŸ¥çœ‹ç•¶å‰ç”¨æˆ¶</button>
          <button class="secondary" onclick="clearAllStorage()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
        </div>
      </div>
      
      <!-- å¿«é€Ÿæ¸¬è©¦æµç¨‹ -->
      <div class="test-flow">
        <h3>âœ¨ æ¨è–¦æ¸¬è©¦æµç¨‹</h3>
        <ol>
          <li>é»æ“Šã€Œå»ºç«‹å¸³æˆ¶ã€å‰µå»ºä¸€å€‹æ–°ç”¨æˆ¶</li>
          <li>åœ¨å³å´iframeé»æ“Šã€Œå»ºç«‹æ–°å¸³æˆ¶ã€æŒ‰éˆ•</li>
          <li>å¡«å¯«è¡¨å–®ä¸¦æäº¤</li>
          <li>é»æ“Šã€ŒæŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶ã€ç¢ºèªå¸³æˆ¶å·²ä¿å­˜</li>
          <li>é»æ“Šã€Œæ¸¬è©¦ç™»å…¥ã€é©—è­‰å¸³æˆ¶</li>
          <li>åœ¨å³å´iframeç”¨æ–°å¸³æˆ¶ç™»å…¥</li>
        </ol>
      </div>
    </div>
    
    <!-- å³å´ï¼šiframe é è¦½ -->
    <div class="iframe-container">
      <iframe src="login.html" title="ç™»å…¥ç³»çµ±é è¦½"></iframe>
    </div>
  </div>
  
  <!-- è¼¸å‡ºé¢æ¿ -->
  <div style="position: fixed; bottom: 0; left: 0; right: 0; max-height: 20vh; background: #1e293b; color: #e2e8f0; padding: 1rem; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.8rem;">
    <div id="console" style="display: flex; flex-direction: column; gap: 0.3rem;"></div>
  </div>
  
  <script>
    // ==================== æ§åˆ¶å°æ—¥èªŒç³»çµ± ====================
    const consoleOutput = document.getElementById('console');
    
    function log(msg, type = 'info') {
      const entry = document.createElement('div');
      const timestamp = new Date().toLocaleTimeString('zh-Hant');
      
      const icons = {
        'info': 'â„¹ï¸',
        'success': 'âœ…',
        'error': 'âŒ',
        'warning': 'âš ï¸',
        'data': 'ğŸ“Š'
      };
      
      entry.style.color = {
        'info': '#94a3b8',
        'success': '#86efac',
        'error': '#ff6b6b',
        'warning': '#fbbf24',
        'data': '#60a5fa'
      }[type] || '#94a3b8';
      
      entry.textContent = `[${timestamp}] ${icons[type]} ${msg}`;
      consoleOutput.appendChild(entry);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      
      // é™åˆ¶æœ€å¤š100æ¢æ—¥èªŒ
      if (consoleOutput.children.length > 100) {
        consoleOutput.removeChild(consoleOutput.children[0]);
      }
    }
    
    // ==================== å¸³æˆ¶ç®¡ç†å‡½æ•¸ ====================
    
    function createAccount() {
      const username = document.getElementById('newUsername').value.trim();
      const password = document.getElementById('newPassword').value;
      const email = document.getElementById('newEmail').value.trim();
      
      log(`é–‹å§‹å»ºç«‹å¸³æˆ¶ï¼š${username}`, 'info');
      
      if (!username || !password) {
        log('âŒ éŒ¯èª¤ï¼šç”¨æˆ¶åå’Œå¯†ç¢¼å¿…å¡«', 'error');
        updateStatus('âŒ ç”¨æˆ¶åå’Œå¯†ç¢¼å¿…å¡«', 'error');
        return;
      }
      
      if (password.length < 4) {
        log('âŒ éŒ¯èª¤ï¼šå¯†ç¢¼è‡³å°‘4å€‹å­—ç¬¦', 'error');
        updateStatus('âŒ å¯†ç¢¼è‡³å°‘éœ€è¦4å€‹å­—ç¬¦', 'error');
        return;
      }
      
      try {
        // è®€å–ç¾æœ‰ç”¨æˆ¶
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        log(`ğŸ“Š ç•¶å‰ç”¨æˆ¶æ•¸ï¼š${users.length}`, 'data');
        
        // æª¢æŸ¥é‡è¤‡
        if (users.some(u => u.username === username)) {
          log(`âŒ éŒ¯èª¤ï¼šç”¨æˆ¶åã€Œ${username}ã€å·²å­˜åœ¨`, 'error');
          updateStatus(`âŒ ç”¨æˆ¶åã€Œ${username}ã€å·²è¢«ä½¿ç”¨`, 'error');
          return;
        }
        
        // å»ºç«‹æ–°ç”¨æˆ¶
        const newUser = {
          id: Date.now().toString(),
          username: username,
          password: password,
          email: email || null,
          createdAt: new Date().toISOString()
        };
        
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        
        log(`âœ… å¸³æˆ¶å·²å»ºç«‹æˆåŠŸï¼`, 'success');
        log(`   ç”¨æˆ¶åï¼š${username}`, 'data');
        log(`   ç”¨æˆ¶IDï¼š${newUser.id}`, 'data');
        log(`   é›»éƒµï¼š${newUser.email || '(æœªè¨­ç½®)'}`, 'data');
        updateStatus(`âœ… å¸³æˆ¶ã€Œ${username}ã€å·²æˆåŠŸå»ºç«‹ï¼ç¾åœ¨å¯ä»¥æ¸¬è©¦ç™»å…¥`, 'success');
        
        // æ¸…é™¤è¡¨å–®
        clearSignupForm();
        
      } catch (error) {
        log(`âŒ éŒ¯èª¤ï¼š${error.message}`, 'error');
        updateStatus(`âŒ å»ºç«‹å¸³æˆ¶å‡ºéŒ¯ï¼š${error.message}`, 'error');
      }
    }
    
    function testLogin() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      log(`é–‹å§‹æ¸¬è©¦ç™»å…¥ï¼š${username}`, 'info');
      
      if (!username || !password) {
        log('âŒ éŒ¯èª¤ï¼šç”¨æˆ¶åå’Œå¯†ç¢¼å¿…å¡«', 'error');
        updateStatus('âŒ ç”¨æˆ¶åå’Œå¯†ç¢¼å¿…å¡«', 'error');
        return;
      }
      
      try {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.username === username && u.password === password);
        
        if (user) {
          // ä¿å­˜æœƒè©±
          const sessionData = {
            id: user.id,
            username: user.username,
            email: user.email,
            loginTime: new Date().toISOString()
          };
          
          localStorage.setItem('current-user', JSON.stringify(sessionData));
          localStorage.setItem('rs-system-session', JSON.stringify({
            userId: user.id,
            username: user.username,
            loginTime: new Date().toISOString()
          }));
          
          log(`âœ… ç™»å…¥æˆåŠŸï¼`, 'success');
          log(`   ç”¨æˆ¶åï¼š${username}`, 'data');
          log(`   ç”¨æˆ¶IDï¼š${user.id}`, 'data');
          log(`   æœƒè©±å·²ä¿å­˜åˆ° localStorage`, 'data');
          updateStatus(`âœ… ç”¨æˆ¶ã€Œ${username}ã€å·²æˆåŠŸç™»å…¥ï¼`, 'success');
          
        } else {
          log(`âŒ éŒ¯èª¤ï¼šç”¨æˆ¶åæˆ–å¯†ç¢¼ä¸æ­£ç¢º`, 'error');
          updateStatus(`âŒ ç”¨æˆ¶åæˆ–å¯†ç¢¼ä¸æ­£ç¢º`, 'error');
        }
      } catch (error) {
        log(`âŒ éŒ¯èª¤ï¼š${error.message}`, 'error');
        updateStatus(`âŒ ç™»å…¥å‡ºéŒ¯ï¼š${error.message}`, 'error');
      }
    }
    
    function showAllUsers() {
      log('æŸ¥è©¢æ‰€æœ‰ç”¨æˆ¶...', 'info');
      try {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        if (users.length === 0) {
          log('âŒ é‚„æ²’æœ‰ä»»ä½•ç”¨æˆ¶', 'warning');
          updateStatus('âŒ é‚„æ²’æœ‰ä»»ä½•ç”¨æˆ¶ï¼Œè«‹å…ˆå»ºç«‹å¸³æˆ¶', 'warning');
        } else {
          log(`âœ… æ‰¾åˆ° ${users.length} å€‹ç”¨æˆ¶ï¼š`, 'success');
          users.forEach((user, idx) => {
            log(`   [${idx + 1}] ${user.username} (ID: ${user.id.substring(0, 8)}..., Email: ${user.email || 'ç„¡'})`, 'data');
          });
        }
      } catch (error) {
        log(`âŒ éŒ¯èª¤ï¼š${error.message}`, 'error');
      }
    }
    
    function showCurrentUser() {
      log('æŸ¥è©¢ç•¶å‰ç™»å…¥ç”¨æˆ¶...', 'info');
      try {
        const currentUser = localStorage.getItem('current-user');
        if (!currentUser) {
          log('âŒ æ²’æœ‰ç”¨æˆ¶ç™»å…¥', 'warning');
          updateStatus('âŒ æ²’æœ‰ç”¨æˆ¶ç™»å…¥', 'warning');
        } else {
          const user = JSON.parse(currentUser);
          log(`âœ… ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼š`, 'success');
          log(`   ç”¨æˆ¶åï¼š${user.username}`, 'data');
          log(`   ç”¨æˆ¶IDï¼š${user.id}`, 'data');
          log(`   é›»éƒµï¼š${user.email || 'ç„¡'}`, 'data');
          log(`   ç™»å…¥æ™‚é–“ï¼š${new Date(user.loginTime).toLocaleString('zh-Hant')}`, 'data');
        }
      } catch (error) {
        log(`âŒ éŒ¯èª¤ï¼š${error.message}`, 'error');
      }
    }
    
    function clearAllStorage() {
      if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚')) {
        log('æ¸…é™¤ localStorage...', 'warning');
        localStorage.removeItem('users');
        localStorage.removeItem('current-user');
        localStorage.removeItem('rs-system-session');
        log('âœ… æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤', 'success');
        updateStatus('âœ… æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤', 'success');
      }
    }
    
    function clearSignupForm() {
      document.getElementById('newUsername').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('newEmail').value = '';
      log('è¨»å†Šè¡¨å–®å·²æ¸…é™¤', 'info');
    }
    
    function clearLoginForm() {
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
      log('ç™»å…¥è¡¨å–®å·²æ¸…é™¤', 'info');
    }
    
    function updateStatus(msg, type = 'info') {
      const statusBox = document.getElementById('statusBox');
      statusBox.textContent = msg;
      statusBox.className = `status-box ${type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : ''}`;
    }
    
    // ==================== åˆå§‹åŒ– ====================
    window.addEventListener('load', () => {
      log('='.repeat(60), 'info');
      log('å»ºç«‹å¸³æˆ¶æ¸¬è©¦å·¥å…·å·²å•Ÿå‹•', 'success');
      log('='.repeat(60), 'info');
      
      try {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const currentUser = localStorage.getItem('current-user');
        
        log(`ç•¶å‰ç’°å¢ƒç‹€æ…‹ï¼š`, 'data');
        log(`  å·²è¨»å†Šç”¨æˆ¶ï¼š${users.length}`, 'data');
        log(`  ç•¶å‰ç™»å…¥ï¼š${currentUser ? 'æ˜¯' : 'å¦'}`, 'data');
        log(``, 'info');
        log(`æç¤ºï¼šåœ¨å³å´iframeä¸­é»æ“Šã€Œå»ºç«‹æ–°å¸³æˆ¶ã€æŒ‰éˆ•é€²è¡Œäº¤äº’æ¸¬è©¦`, 'info');
      } catch (error) {
        log(`åˆå§‹åŒ–éŒ¯èª¤ï¼š${error.message}`, 'error');
      }
    });
  </script>
</body>
</html>
