<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RS System - ç™»å…¥èˆ‡å„²å­˜åº«é©—è­‰æ¸¬è©¦</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .content {
      padding: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }
    .test-section h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    .test-controls {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .test-controls input,
    .test-controls select {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      flex: 1;
      min-width: 150px;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    .result.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .result.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .result.info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }
    .status-badge.pass {
      background: #d4edda;
      color: #155724;
    }
    .status-badge.fail {
      background: #f8d7da;
      color: #721c24;
    }
    .status-badge.pending {
      background: #fff3cd;
      color: #856404;
    }
    .summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
    }
    .summary h3 {
      color: #333;
      margin-bottom: 15px;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    .summary-card {
      background: white;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .summary-card h4 {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }
    .summary-card .value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” RS System åŠŸèƒ½é©—è­‰æ¸¬è©¦</h1>
      <p>ç™»å…¥åŠŸèƒ½ + å„²å­˜åº«è³‡æ–™éš”é›¢é©—è­‰</p>
    </div>

    <div class="content">
      <!-- æ¸¬è©¦ 1: ä½¿ç”¨è€…è¨»å†Š -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 1: ç”¨æˆ¶è¨»å†ŠåŠŸèƒ½ <span class="status-badge pending" id="test1-status">å¾…åŸ·è¡Œ</span></h3>
        <div class="test-controls">
          <input type="text" id="reg-username" placeholder="ç”¨æˆ¶å (ä¾‹å¦‚: user1)">
          <input type="email" id="reg-email" placeholder="é›»å­éƒµä»¶">
          <input type="password" id="reg-password" placeholder="å¯†ç¢¼ (è‡³å°‘4ä½)">
          <button onclick="testRegister()">åŸ·è¡Œè¨»å†Šæ¸¬è©¦</button>
        </div>
        <div id="test1-result"></div>
      </div>

      <!-- æ¸¬è©¦ 2: ç”¨æˆ¶ç™»å…¥ -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 2: ç”¨æˆ¶ç™»å…¥åŠŸèƒ½ <span class="status-badge pending" id="test2-status">å¾…åŸ·è¡Œ</span></h3>
        <div class="test-controls">
          <input type="text" id="login-username" placeholder="ç”¨æˆ¶å">
          <input type="password" id="login-password" placeholder="å¯†ç¢¼">
          <button onclick="testLogin()">åŸ·è¡Œç™»å…¥æ¸¬è©¦</button>
        </div>
        <div id="test2-result"></div>
      </div>

      <!-- æ¸¬è©¦ 3: å„²å­˜åº«åˆå§‹åŒ– -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 3: ç”¨æˆ¶å°ˆå±¬å„²å­˜åº«åˆå§‹åŒ– <span class="status-badge pending" id="test3-status">å¾…åŸ·è¡Œ</span></h3>
        <button onclick="testStorageInit()">æª¢æŸ¥å„²å­˜åº«ç‹€æ…‹</button>
        <div id="test3-result"></div>
      </div>

      <!-- æ¸¬è©¦ 4: è³‡æ–™å¯«å…¥ -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 4: è³‡æ–™å¯«å…¥æ¸¬è©¦ <span class="status-badge pending" id="test4-status">å¾…åŸ·è¡Œ</span></h3>
        <div class="test-controls">
          <input type="text" id="class-name" placeholder="ç­ç´šåç¨± (ä¾‹å¦‚: Aç­)">
          <input type="date" id="class-date" value="">
          <button onclick="testDataWrite()">å¯«å…¥æ¸¬è©¦è³‡æ–™</button>
        </div>
        <div id="test4-result"></div>
      </div>

      <!-- æ¸¬è©¦ 5: è³‡æ–™è®€å– -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 5: è³‡æ–™è®€å–æ¸¬è©¦ <span class="status-badge pending" id="test5-status">å¾…åŸ·è¡Œ</span></h3>
        <button onclick="testDataRead()">è®€å–ç•¶å‰ç”¨æˆ¶è³‡æ–™</button>
        <div id="test5-result"></div>
      </div>

      <!-- æ¸¬è©¦ 6: ç”¨æˆ¶åˆ‡æ›æ¸¬è©¦ -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 6: ç”¨æˆ¶åˆ‡æ›èˆ‡è³‡æ–™éš”é›¢ <span class="status-badge pending" id="test6-status">å¾…åŸ·è¡Œ</span></h3>
        <div class="test-controls">
          <select id="switch-user">
            <option value="">é¸æ“‡ç”¨æˆ¶...</option>
          </select>
          <button onclick="testUserSwitch()">åˆ‡æ›ç”¨æˆ¶ä¸¦é©—è­‰è³‡æ–™</button>
        </div>
        <div id="test6-result"></div>
      </div>

      <!-- æ¸¬è©¦ 7: ç™»å‡ºåŠŸèƒ½ -->
      <div class="test-section">
        <h3>æ¸¬è©¦ 7: ç™»å‡ºåŠŸèƒ½ <span class="status-badge pending" id="test7-status">å¾…åŸ·è¡Œ</span></h3>
        <button onclick="testLogout()">åŸ·è¡Œç™»å‡ºæ¸¬è©¦</button>
        <div id="test7-result"></div>
      </div>

      <!-- æ¸¬è©¦ç¸½çµ -->
      <div class="summary">
        <h3>ğŸ“Š æ¸¬è©¦ç¸½çµå ±å‘Š</h3>
        <div class="summary-grid">
          <div class="summary-card">
            <h4>ç¸½æ¸¬è©¦æ•¸</h4>
            <div class="value" id="total-tests">7</div>
          </div>
          <div class="summary-card">
            <h4>é€šé</h4>
            <div class="value" style="color: #28a745;" id="passed-tests">0</div>
          </div>
          <div class="summary-card">
            <h4>å¤±æ•—</h4>
            <div class="value" style="color: #dc3545;" id="failed-tests">0</div>
          </div>
          <div class="summary-card">
            <h4>æˆåŠŸç‡</h4>
            <div class="value" style="color: #17a2b8;" id="success-rate">0%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- å¼•å…¥å¿…è¦çš„è…³æœ¬ï¼šåƒ…ä¿ç•™ PouchDB + system.js -->
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
  <script src="logger-service.js"></script>
  <script src="system.js"></script>

  <script>
    // æ¸¬è©¦ç‹€æ…‹è¿½è¹¤
    const testResults = { total: 7, passed: 0, failed: 0 };

    // é è¨­æ—¥æœŸ
    document.getElementById('class-date').valueAsDate = new Date();

    // --- åŸºç¤å·¥å…·ï¼šç”¨æˆ¶æ¨¡å‹ï¼ˆèˆ‡ system.js çš„ LOGIN_MANAGER ç›¸å®¹ï¼‰
    function migrateUsers() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const migrated = users.map(u => {
        const userId = u.userId || u.id || `user_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;
        const passwordHash = u.passwordHash || (u.password ? LOGIN_MANAGER.hashPassword(u.password) : LOGIN_MANAGER.hashPassword('1234'));
        return {
          ...u,
          userId,
          id: userId,
          passwordHash,
          password: undefined,
          role: u.role || 'user',
          email: u.email || ''
        };
      });
      localStorage.setItem('users', JSON.stringify(migrated));
    }

    migrateUsers();

    let loginInitialized = false;
    async function ensureLoginReady() {
      if (!loginInitialized) {
        await LOGIN_MANAGER.init();
        loginInitialized = true;
      }
    }

    const authManager = {
      _hashPassword(pwd) {
        return LOGIN_MANAGER.hashPassword(pwd);
      },
      async register(username, password, email = '', role = 'user') {
        await ensureLoginReady();
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        if (users.some(u => u.username === username)) {
          return { success: false, error: 'ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨' };
        }
        const userId = `user_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;
        const user = {
          userId,
          id: userId,
          username,
          email,
          role,
          passwordHash: LOGIN_MANAGER.hashPassword(password),
          createdAt: new Date().toISOString()
        };
        users.push(user);
        localStorage.setItem('users', JSON.stringify(users));
        return { success: true, userId };
      },
      async login(username, password) {
        await ensureLoginReady();
        return await LOGIN_MANAGER.login(username, password);
      },
      async logout() {
        await ensureLoginReady();
        return LOGIN_MANAGER.logout();
      },
      getCurrentUser() {
        return LOGIN_MANAGER.getCurrentUser();
      },
      getAllUsers() {
        return JSON.parse(localStorage.getItem('users') || '[]');
      }
    };

    function getUserDb(userId) {
      return new PouchDB(`rs-system-${userId}`);
    }

    // æ›´æ–°ç”¨æˆ¶åˆ—è¡¨ä¸‹æ‹‰é¸å–®
    function updateUserList() {
      const users = authManager.getAllUsers();
      const select = document.getElementById('switch-user');
      select.innerHTML = '<option value="">é¸æ“‡ç”¨æˆ¶...</option>';
      users.forEach(user => {
        const option = document.createElement('option');
        option.value = user.userId || user.id;
        option.textContent = `${user.username} (${user.email || 'ç„¡é›»éƒµ'})`;
        select.appendChild(option);
      });
    }

    updateUserList();

    // é¡¯ç¤ºçµæœ
    function showResult(testId, message, type = 'info') {
      const resultDiv = document.getElementById(`test${testId}-result`);
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;

      const statusBadge = document.getElementById(`test${testId}-status`);
      if (type === 'success') {
        statusBadge.className = 'status-badge pass';
        statusBadge.textContent = 'âœ“ é€šé';
        testResults.passed++;
      } else if (type === 'error') {
        statusBadge.className = 'status-badge fail';
        statusBadge.textContent = 'âœ— å¤±æ•—';
        testResults.failed++;
      }

      updateSummary();
    }

    // æ›´æ–°ç¸½çµ
    function updateSummary() {
      document.getElementById('passed-tests').textContent = testResults.passed;
      document.getElementById('failed-tests').textContent = testResults.failed;
      const rate = ((testResults.passed / testResults.total) * 100 || 0).toFixed(1);
      document.getElementById('success-rate').textContent = rate + '%';
    }

    // æ¸¬è©¦ 1: ç”¨æˆ¶è¨»å†Š
    async function testRegister() {
      const username = document.getElementById('reg-username').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const password = document.getElementById('reg-password').value;

      if (!username || !email || !password) {
        showResult(1, 'âŒ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½', 'error');
        return;
      }

      try {
        const result = await authManager.register(username, password, email);
        if (result.success) {
          showResult(1, `âœ… è¨»å†ŠæˆåŠŸï¼\nç”¨æˆ¶ ID: ${result.userId}\nç”¨æˆ¶å: ${username}\né›»å­éƒµä»¶: ${email}`, 'success');
          updateUserList();
        } else {
          showResult(1, `âŒ è¨»å†Šå¤±æ•—: ${result.error}`, 'error');
        }
      } catch (error) {
        showResult(1, `âŒ è¨»å†Šéç¨‹ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 2: ç”¨æˆ¶ç™»å…¥
    async function testLogin() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;

      if (!username || !password) {
        showResult(2, 'âŒ è«‹å¡«å¯«ç”¨æˆ¶åå’Œå¯†ç¢¼', 'error');
        return;
      }

      try {
        const result = await authManager.login(username, password);
        if (result.success) {
          const session = localStorage.getItem('rs-system-session');
          showResult(2, `âœ… ç™»å…¥æˆåŠŸï¼\nç”¨æˆ¶: ${result.user.username}\nID: ${result.user.id}\næœƒè©±å·²å»ºç«‹: ${session ? 'æ˜¯' : 'å¦'}`, 'success');
        } else {
          showResult(2, `âŒ ç™»å…¥å¤±æ•—: ${result.error}`, 'error');
        }
      } catch (error) {
        showResult(2, `âŒ ç™»å…¥éç¨‹ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 3: å„²å­˜åº«åˆå§‹åŒ–
    async function testStorageInit() {
      try {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          showResult(3, 'âŒ è«‹å…ˆç™»å…¥', 'error');
          return;
        }

        const db = getUserDb(currentUser.id || currentUser.userId);
        const info = await db.info();
        showResult(3, `âœ… å„²å­˜åº«åˆå§‹åŒ–æˆåŠŸï¼\n\nè³‡æ–™åº«åç¨±: rs-system-${currentUser.id || currentUser.userId}\næ–‡æª”æ•¸é‡: ${info.doc_count}\nå·²åˆªé™¤æ–‡æª”: ${info.doc_del_count}\nè³‡æ–™å¤§å°: ${info.data_size} bytes\n\næ¯å€‹ç”¨æˆ¶æ“æœ‰ç¨ç«‹çš„ PouchDB è³‡æ–™åº«å¯¦ä¾‹`, 'success');
      } catch (error) {
        showResult(3, `âŒ å„²å­˜åº«åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 4: è³‡æ–™å¯«å…¥
    async function testDataWrite() {
      try {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          showResult(4, 'âŒ è«‹å…ˆç™»å…¥', 'error');
          return;
        }

        const className = document.getElementById('class-name').value.trim();
        const classDate = document.getElementById('class-date').value;
        if (!className || !classDate) {
          showResult(4, 'âŒ è«‹å¡«å¯«ç­ç´šåç¨±å’Œæ—¥æœŸ', 'error');
          return;
        }

        const db = getUserDb(currentUser.id || currentUser.userId);
        const checkpointData = {
          _id: `checkpoint_${Date.now()}`,
          type: 'checkpoint',
          className,
          date: classDate,
          atmosphere: 'è‰¯å¥½',
          skillLevel: 'ä¸­ç­‰',
          studentRecords: [
            { studentId: 'S001', studentName: 'æ¸¬è©¦å­¸ç”Ÿ1', performance: 'å„ªç§€' },
            { studentId: 'S002', studentName: 'æ¸¬è©¦å­¸ç”Ÿ2', performance: 'è‰¯å¥½' }
          ],
          notes: 'é€™æ˜¯æ¸¬è©¦è³‡æ–™',
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
          userId: currentUser.id || currentUser.userId
        };

        const result = await db.put(checkpointData);
        showResult(4, `âœ… è³‡æ–™å¯«å…¥æˆåŠŸï¼\n\næ–‡æª” ID: ${result.id}\nç­ç´š: ${className}\næ—¥æœŸ: ${classDate}\nå­¸ç”Ÿæ•¸: 2\n\nè³‡æ–™å·²å„²å­˜åˆ°ç”¨æˆ¶ ${currentUser.username} çš„å°ˆå±¬è³‡æ–™åº«`, 'success');
      } catch (error) {
        showResult(4, `âŒ è³‡æ–™å¯«å…¥å¤±æ•—: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 5: è³‡æ–™è®€å–
    async function testDataRead() {
      try {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          showResult(5, 'âŒ è«‹å…ˆç™»å…¥', 'error');
          return;
        }

        const db = getUserDb(currentUser.id || currentUser.userId);
        const result = await db.allDocs({ include_docs: true, startkey: 'checkpoint', endkey: 'checkpoint\ufff0' });
        const checkpoints = result.rows.filter(row => row.doc.type === 'checkpoint').map(row => row.doc);

        let message = `âœ… è³‡æ–™è®€å–æˆåŠŸï¼\n\nç•¶å‰ç”¨æˆ¶: ${currentUser.username}\nè³‡æ–™åº«: rs-system-${currentUser.id || currentUser.userId}\nèª²å ‚è¨˜éŒ„æ•¸é‡: ${checkpoints.length}\n\n`;
        if (checkpoints.length > 0) {
          message += 'æœ€è¿‘çš„è¨˜éŒ„:\n';
          checkpoints.slice(0, 3).forEach((cp, idx) => {
            message += `\n${idx + 1}. ${cp.className} - ${cp.date}\n   å­¸ç”Ÿæ•¸: ${cp.studentRecords?.length || 0}\n   å‚™è¨»: ${cp.notes || 'ç„¡'}`;
          });
        } else {
          message += 'å°šç„¡èª²å ‚è¨˜éŒ„ï¼Œè«‹å…ˆåŸ·è¡Œã€Œæ¸¬è©¦ 4: è³‡æ–™å¯«å…¥ã€';
        }
        showResult(5, message, 'success');
      } catch (error) {
        showResult(5, `âŒ è³‡æ–™è®€å–å¤±æ•—: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 6: ç”¨æˆ¶åˆ‡æ›èˆ‡è³‡æ–™éš”é›¢
    async function testUserSwitch() {
      try {
        const currentUser = authManager.getCurrentUser();
        const targetUserId = document.getElementById('switch-user').value;
        if (!targetUserId) {
          showResult(6, 'âŒ è«‹é¸æ“‡è¦åˆ‡æ›çš„ç”¨æˆ¶', 'error');
          return;
        }

        let currentUserData = [];
        if (currentUser) {
          const currentDb = getUserDb(currentUser.id || currentUser.userId);
          const currentResult = await currentDb.allDocs({ include_docs: true, startkey: 'checkpoint', endkey: 'checkpoint\ufff0' });
          currentUserData = currentResult.rows.filter(r => r.doc.type === 'checkpoint');
        }

        const targetDb = getUserDb(targetUserId);
        const targetResult = await targetDb.allDocs({ include_docs: true, startkey: 'checkpoint', endkey: 'checkpoint\ufff0' });
        const targetUserData = targetResult.rows.filter(r => r.doc.type === 'checkpoint');

        const users = authManager.getAllUsers();
        const targetUser = users.find(u => (u.userId || u.id) === targetUserId);

        let message = `âœ… ç”¨æˆ¶åˆ‡æ›æ¸¬è©¦æˆåŠŸï¼\n\n`;
        message += `åŸç”¨æˆ¶: ${currentUser?.username || 'ç„¡'}\n`;
        message += `åŸç”¨æˆ¶è³‡æ–™æ•¸: ${currentUserData.length}\n\n`;
        message += `åˆ‡æ›è‡³: ${targetUser?.username || 'æœªçŸ¥'}\n`;
        message += `æ–°ç”¨æˆ¶è³‡æ–™æ•¸: ${targetUserData.length}\n\n`;
        message += `âœ“ è³‡æ–™éš”é›¢é©—è­‰: ${currentUserData.length !== targetUserData.length || currentUserData.length === 0 ? 'é€šé' : 'éœ€æª¢æŸ¥'}\n`;
        message += `âœ“ æ¯å€‹ç”¨æˆ¶æ“æœ‰ç¨ç«‹çš„è³‡æ–™åº«: rs-system-${targetUserId}`;

        showResult(6, message, 'success');
      } catch (error) {
        showResult(6, `âŒ ç”¨æˆ¶åˆ‡æ›æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
      }
    }

    // æ¸¬è©¦ 7: ç™»å‡ºåŠŸèƒ½
    async function testLogout() {
      try {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          showResult(7, 'âŒ æ²’æœ‰ç”¨æˆ¶ç™»å…¥', 'error');
          return;
        }

        const username = currentUser.username;
        await authManager.logout();
        const sessionAfter = localStorage.getItem('rs-system-session');
        const userAfter = localStorage.getItem('current-user');
        if (!sessionAfter && !userAfter) {
          showResult(7, `âœ… ç™»å‡ºæˆåŠŸï¼\n\nç”¨æˆ¶ ${username} å·²ç™»å‡º\næœƒè©±å·²æ¸…é™¤: æ˜¯\nç”¨æˆ¶è³‡æ–™å·²æ¸…é™¤: æ˜¯\n\næ‰€æœ‰ç™»å…¥ç‹€æ…‹å·²æ¸…ç©º`, 'success');
        } else {
          showResult(7, `âš ï¸ ç™»å‡ºéƒ¨åˆ†å®Œæˆ\næœƒè©±å·²æ¸…é™¤: ${!sessionAfter}\nç”¨æˆ¶è³‡æ–™å·²æ¸…é™¤: ${!userAfter}`, 'error');
        }
      } catch (error) {
        showResult(7, `âŒ ç™»å‡ºæ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
      }
    }
  </script>
</body>
</html>
