<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•´åˆæ¸¬è©¦ - æ‰€æœ‰æ¨¡çµ„</title>
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
    h1 { color: #333; border-bottom: 3px solid #ff9800; padding-bottom: 10px; }
    .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .test-section h2 { color: #ff9800; margin-top: 0; font-size: 18px; }
    .result { background: #f9f9f9; padding: 8px; margin: 8px 0; font-family: monospace; font-size: 13px; border-left: 4px solid #4caf50; }
    .result.fail { border-left-color: #f44336; }
    button { background: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:hover { background: #f57c00; }
    .summary { font-size: 16px; font-weight: bold; padding: 15px; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>ğŸ”„ æ•´åˆæ¸¬è©¦ï¼šå…¨ç³»çµ±æ¨¡çµ„é©—è­‰</h1>

  <div class="test-section">
    <h2>æ¸¬è©¦ 1ï¼šç¸½åŒ¯å‡ºæ•¸é‡</h2>
    <div id="test-exports" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 2ï¼šéšæ®µ 1 æ¨¡çµ„ï¼ˆå·¥å…·èˆ‡å¸¸æ•¸ï¼‰</h2>
    <div id="test-phase1" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 3ï¼šéšæ®µ 2 æ¨¡çµ„ï¼ˆæ ¸å¿ƒæœå‹™ï¼‰</h2>
    <div id="test-phase2" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 4ï¼šéšæ®µ 3 æ¨¡çµ„ï¼ˆUI ç®¡ç†ï¼‰</h2>
    <div id="test-phase3" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 5ï¼šéšæ®µ 4 æ¨¡çµ„ï¼ˆåˆå§‹åŒ–ï¼‰</h2>
    <div id="test-phase4" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 6ï¼šç‰ˆæœ¬è³‡è¨Š</h2>
    <div id="test-version" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 7ï¼šå¿«é€Ÿå•Ÿå‹• API</h2>
    <div id="test-quick-api" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 8ï¼šæ¨¡çµ„å¯ç”¨æ€§ API</h2>
    <div id="test-module-api" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 9ï¼šè·¨æ¨¡çµ„ä¾è³´</h2>
    <div id="test-cross-deps" class="result"></div>
  </div>

  <div class="test-section">
    <h2>æ¸¬è©¦ 10ï¼šæœ€çµ‚é©—è­‰</h2>
    <button onclick="runAllTests()">åŸ·è¡Œå®Œæ•´æ¸¬è©¦</button>
    <div id="test-final" class="result summary"></div>
  </div>

  <script type="module">
    async function runAllTests() {
      const results = [];
      let mainModule;

      try {
        mainModule = await import('./src/main.js');
      } catch (e) {
        alert('ç„¡æ³•è¼‰å…¥ main.jsï¼š' + e.message);
        return;
      }

      // æ¸¬è©¦ 1: ç¸½åŒ¯å‡ºæ•¸é‡
      try {
        const exportCount = Object.keys(mainModule).length;
        const passed = exportCount >= 25;
        document.getElementById('test-exports').textContent = 
          `${passed ? 'âœ…' : 'âŒ'} ç¸½åŒ¯å‡ºæ•¸é‡ï¼š${exportCount} å€‹ (é æœŸ >= 25)`;
        document.getElementById('test-exports').className = passed ? 'result' : 'result fail';
        results.push(passed);
      } catch (e) {
        document.getElementById('test-exports').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-exports').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 2: Phase 1
      try {
        const { $, escapeHtml, formatFileSize, isValidDate, STORAGE_KEY } = mainModule;
        const hasAll = $ && escapeHtml && formatFileSize && isValidDate && STORAGE_KEY;
        document.getElementById('test-phase1').textContent = 
          hasAll ? 'âœ… Phase 1 æ¨¡çµ„å®Œæ•´ ($, escapeHtml, formatFileSize, isValidDate, STORAGE_KEY)' : 
          'âŒ Phase 1 æ¨¡çµ„ä¸å®Œæ•´';
        document.getElementById('test-phase1').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-phase1').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-phase1').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 3: Phase 2
      try {
        const { STORAGE_MANAGER, LOGIN_MANAGER, RecordsService, PresetsService } = mainModule;
        const hasAll = STORAGE_MANAGER && LOGIN_MANAGER && RecordsService && PresetsService;
        document.getElementById('test-phase2').textContent = 
          hasAll ? 'âœ… Phase 2 æ¨¡çµ„å®Œæ•´ (STORAGE_MANAGER, LOGIN_MANAGER, RecordsService, PresetsService)' : 
          'âŒ Phase 2 æ¨¡çµ„ä¸å®Œæ•´';
        document.getElementById('test-phase2').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-phase2').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-phase2').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 4: Phase 3
      try {
        const { UI_MANAGER, FormManager, ListRenderer, ModalManager } = mainModule;
        const hasAll = UI_MANAGER && FormManager && ListRenderer && ModalManager;
        document.getElementById('test-phase3').textContent = 
          hasAll ? 'âœ… Phase 3 æ¨¡çµ„å®Œæ•´ (UI_MANAGER, FormManager, ListRenderer, ModalManager)' : 
          'âŒ Phase 3 æ¨¡çµ„ä¸å®Œæ•´';
        document.getElementById('test-phase3').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-phase3').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-phase3').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 5: Phase 4
      try {
        const { AppInit, LoginPageInit, APP_CONFIG } = mainModule;
        const hasAll = AppInit && LoginPageInit && APP_CONFIG;
        document.getElementById('test-phase4').textContent = 
          hasAll ? 'âœ… Phase 4 æ¨¡çµ„å®Œæ•´ (AppInit, LoginPageInit, APP_CONFIG)' : 
          'âŒ Phase 4 æ¨¡çµ„ä¸å®Œæ•´';
        document.getElementById('test-phase4').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-phase4').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-phase4').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 6: ç‰ˆæœ¬è³‡è¨Š
      try {
        const { VERSION, VERSION_INFO } = mainModule;
        const hasAll = VERSION && VERSION_INFO && VERSION_INFO.version === VERSION;
        document.getElementById('test-version').textContent = 
          hasAll ? `âœ… ç‰ˆæœ¬è³‡è¨Šï¼š${VERSION} (${VERSION_INFO.name})` : 
          'âŒ ç‰ˆæœ¬è³‡è¨Šä¸å®Œæ•´';
        document.getElementById('test-version').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-version').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-version').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 7: å¿«é€Ÿå•Ÿå‹• API
      try {
        const { initApp, initLoginPage } = mainModule;
        const hasAll = typeof initApp === 'function' && typeof initLoginPage === 'function';
        document.getElementById('test-quick-api').textContent = 
          hasAll ? 'âœ… å¿«é€Ÿå•Ÿå‹• API å¯ç”¨ (initApp, initLoginPage)' : 
          'âŒ å¿«é€Ÿå•Ÿå‹• API ä¸å¯ç”¨';
        document.getElementById('test-quick-api').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-quick-api').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-quick-api').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 8: æ¨¡çµ„å¯ç”¨æ€§ API
      try {
        const { isModuleAvailable, getAppInfo } = mainModule;
        const coreAvailable = isModuleAvailable('core');
        const info = getAppInfo();
        const hasAll = coreAvailable && info.modules.core;
        document.getElementById('test-module-api').textContent = 
          hasAll ? 'âœ… æ¨¡çµ„å¯ç”¨æ€§ API æ­£å¸¸ (isModuleAvailable, getAppInfo)' : 
          'âŒ æ¨¡çµ„å¯ç”¨æ€§ API ç•°å¸¸';
        document.getElementById('test-module-api').className = hasAll ? 'result' : 'result fail';
        results.push(hasAll);
      } catch (e) {
        document.getElementById('test-module-api').textContent = 'âŒ éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-module-api').className = 'result fail';
        results.push(false);
      }

      // æ¸¬è©¦ 9: è·¨æ¨¡çµ„ä¾è³´
      try {
        await import('./src/main.js');
        document.getElementById('test-cross-deps').textContent = 'âœ… ç„¡å¾ªç’°ä¾è³´ï¼Œæ‰€æœ‰æ¨¡çµ„å¯æ­£å¸¸è¼‰å…¥';
        document.getElementById('test-cross-deps').className = 'result';
        results.push(true);
      } catch (e) {
        document.getElementById('test-cross-deps').textContent = 'âŒ å¾ªç’°ä¾è³´æˆ–è¼‰å…¥éŒ¯èª¤ï¼š' + e.message;
        document.getElementById('test-cross-deps').className = 'result fail';
        results.push(false);
      }

      // æœ€çµ‚é©—è­‰
      const passed = results.filter(r => r).length;
      const total = results.length;
      const allPassed = passed === total;
      document.getElementById('test-final').textContent = 
        allPassed ? 
        `âœ… æ•´åˆæ¸¬è©¦å®Œæˆï¼š${passed}/${total} é€šé\nğŸ‰ æ‰€æœ‰æ¨¡çµ„é‹ä½œæ­£å¸¸ï¼ç³»çµ±å·²æº–å‚™å°±ç·’ã€‚` : 
        `âš ï¸ æ•´åˆæ¸¬è©¦å®Œæˆï¼š${passed}/${total} é€šé\nè«‹æª¢æŸ¥å¤±æ•—çš„æ¸¬è©¦é …ç›®ã€‚`;
      document.getElementById('test-final').className = 
        allPassed ? 'result summary' : 'result summary fail';

      console.log('âœ… æ•´åˆæ¸¬è©¦å®Œæˆ', { passed, total, allPassed });
    }

    window.runAllTests = runAllTests;
    runAllTests();
  </script>
</body>
</html>
