<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ•™ç·´è¨˜éŒ„ç³»çµ± Â· ç™»å…¥</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â—‡</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- ES Module æ”¯æ´ Vite æ§‹å»º -->
  <script src="logger-service.js" type="module"></script>
  <script src="system.js" type="module"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .login-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 420px;
      padding: 2.5rem;
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .login-header h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: #1e293b;
      font-weight: 700;
    }
    
    .login-header p {
      color: #64748b;
      font-size: 0.95rem;
    }
    
    .message {
      margin-bottom: 1rem;
      padding: 0.75rem;
      border-radius: 6px;
      border-left: 4px solid;
      display: none;
      font-size: 0.85rem;
    }
    
    .error-msg {
      background: #fee2e2;
      color: #dc2626;
      border-left-color: #dc2626;
    }
    
    .success-msg {
      background: #d1fae5;
      color: #059669;
      border-left-color: #059669;
    }
    
    .message.show {
      display: block;
    }
    
    .form-section {
      display: none;
    }
    
    .form-section.active {
      display: block;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    
    .form-group label {
      font-weight: 500;
      color: #1e293b;
      font-size: 0.9rem;
    }
    
    .form-group input {
      padding: 0.7rem 0.9rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-group input::placeholder {
      color: #cbd5e1;
    }
    
    .btn-login {
      padding: 0.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 0.5rem;
      font-family: inherit;
    }
    
    .btn-login:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-login:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .toggle-form {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e8f0;
    }
    
    .toggle-form p {
      color: #64748b;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }
    
    .btn-toggle {
      color: #667eea;
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: underline;
      font-size: 0.9rem;
      font-weight: 600;
      font-family: inherit;
    }
    
    .btn-toggle:hover {
      color: #764ba2;
    }
    
    .mode-indicator {
      text-align: center;
      color: #cbd5e1;
      font-size: 0.75rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <h1>â—‡ æ•™ç·´è¨˜éŒ„ç³»çµ±</h1>
      <p> è·³ç¹©èª²å ‚ç®¡ç†å¹³è‡º</p>
    </div>
    
    <div class="error-msg message" id="errorMsg"></div>
    <div class="success-msg message" id="successMsg"></div>
    
    <!-- ç™»å…¥è¡¨å–® -->
    <div id="loginSection" class="form-section active">
      <form class="login-form" id="loginForm">
        <div class="form-group">
          <label for="loginUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="loginUsername" placeholder="è¼¸å…¥æ‚¨çš„ä½¿ç”¨è€…åç¨±" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">å¯†ç¢¼</label>
          <input type="password" id="loginPassword" placeholder="è¼¸å…¥æ‚¨çš„å¯†ç¢¼" required>
        </div>
        <button type="submit" class="btn-login" id="btnLogin">ç™»å…¥</button>
      </form>
    </div>
    
    <!-- è¨»å†Šè¡¨å–® -->
    <div id="signupSection" class="form-section">
      <form class="login-form" id="signupForm">
        <div class="form-group">
          <label for="signupUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="signupUsername" placeholder="å»ºç«‹æ–°çš„ä½¿ç”¨è€…åç¨±" required>
        </div>
        <div class="form-group">
          <label for="signupPassword">å¯†ç¢¼</label>
          <input type="password" id="signupPassword" placeholder="å»ºç«‹æ–°å¯†ç¢¼ (æœ€å°‘4å€‹å­—)" required>
        </div>
        <div class="form-group">
          <label for="signupEmail">é›»éƒµ <span style="color: #999;">(å¯é¸)</span></label>
          <input type="email" id="signupEmail" placeholder="æ‚¨çš„é›»éƒµåœ°å€ (å¯é¸)">
        </div>
        <button type="submit" class="btn-login" id="btnSignup">å»ºç«‹å¸³æˆ¶</button>
      </form>
    </div>
    
    <!-- è¡¨å–®åˆ‡æ› -->
    <div class="toggle-form">
      <div id="toSignupSection" style="display: block;">
        <p>æ²’æœ‰å¸³æˆ¶?</p>
        <button type="button" class="btn-toggle" id="switchToSignup">å»ºç«‹æ–°å¸³æˆ¶</button>
      </div>
      <div id="toLoginSection" style="display: none;">
        <p>å·²æœ‰å¸³æˆ¶?</p>
        <button type="button" class="btn-toggle" id="switchToLogin">è¿”å›ç™»å…¥</button>
      </div>
    </div>
    
    <div class="mode-indicator">æœ¬åœ°å­˜å„²æ¨¡å¼ â€¢ v3.1</div>
  </div>

  <script>
    // â­ ä¸»æ§å°è¼¸å‡º - äººæ€§åŒ–è¨Šæ¯
    console.log('%cğŸš€ æ•™ç·´è¨˜éŒ„ç³»çµ± - ç™»å…¥é é¢', 'color: #667eea; font-size: 16px; font-weight: bold;');
    console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #cbd5e1;');
    console.log('âœ… é é¢å·²è¼‰å…¥');
    console.log('ğŸ“ ç­‰å¾…ä½¿ç”¨è€…æ“ä½œ...');

    // ç­‰å¾… system.js å’Œ LOGIN_MANAGER åŠ è¼‰å®Œæˆ
    function initLoginPage() {
      if (typeof LOGIN_MANAGER === 'undefined') {
        console.log('âŒ› ç­‰å¾… LOGIN_MANAGER åŠ è¼‰...');
        setTimeout(initLoginPage, 100);
        return;
      }

      console.log('âœ… LOGIN_MANAGER å·²å°±ç·’');
      console.log('âœ… èªè­‰ç³»çµ±æº–å‚™å®Œæˆ');

      // ç™»å…¥è¡¨å–®æäº¤
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault(); // é˜²æ­¢è¡¨å–®é»˜èªé‡è¼‰
        console.log('%cğŸ”‘ ç™»å…¥è™•ç†é–‹å§‹', 'color: #0ea5e9; font-weight: bold;');
        
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value;
        
        console.log(`ğŸ‘¤ ä½¿ç”¨è€…åç¨±: ${username}`);
        
        const btn = document.getElementById('btnLogin');
        btn.disabled = true;
        btn.textContent = 'ç™»å…¥ä¸­...';
        
        try {
          const result = await LOGIN_MANAGER.login(username, password);
          console.log('ğŸ“¡ ç™»å…¥çµæœ:', result);
          
          if (result.success) {
            console.log('%câœ… ç™»å…¥æˆåŠŸï¼', 'color: #10b981; font-size: 14px; font-weight: bold;');
            console.log(`ğŸ‰ æ­¡è¿å›ä¾†ï¼Œ${result.user.username}ï¼`);
            console.log(`ğŸ‘‘ æ¬Šé™: ${result.user.role === 'creator' ? 'å‰µå»ºè€…' : 'ä¸€èˆ¬ä½¿ç”¨è€…'}`);
            
            showMessage('success', `æ­¡è¿å›ä¾†ï¼Œ${result.user.username}ï¼`);
            
            // â­ ç™»å…¥æˆåŠŸå¾Œè·³è½‰åˆ° index.html
            console.log('ğŸ”€ æ­£åœ¨è·³è½‰è‡³ä¸»é ...');
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 1000);
          } else {
            console.log('%câŒ ç™»å…¥å¤±æ•—', 'color: #ef4444; font-size: 14px; font-weight: bold;');
            console.log(`âš ï¸  åŸå› : ${result.message}`);
            showMessage('error', result.message || 'ä½¿ç”¨è€…åç¨±æˆ–å¯†ç¢¼éŒ¯èª¤');
            btn.disabled = false;
            btn.textContent = 'ç™»å…¥';
          }
        } catch (error) {
          console.error('%câŒ ç™»å…¥éŒ¯èª¤', 'color: #ef4444; font-size: 14px; font-weight: bold;');
          console.error('ğŸ› éŒ¯èª¤è©³æƒ…:', error);
          showMessage('error', 'ç™»å…¥éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
          btn.disabled = false;
          btn.textContent = 'ç™»å…¥';
        }
      });

      // è¨»å†Šè¡¨å–®æäº¤
      document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault(); // é˜²æ­¢è¡¨å–®é»˜èªé‡è¼‰
        console.log('%câœï¸ è¨»å†Šè™•ç†é–‹å§‹', 'color: #8b5cf6; font-weight: bold;');
        
        const username = document.getElementById('signupUsername').value.trim();
        const password = document.getElementById('signupPassword').value;
        const email = document.getElementById('signupEmail').value.trim();
        
        console.log(`ğŸ‘¤ æ–°ä½¿ç”¨è€…: ${username}`);
        if (email) console.log(`ğŸ“§ é›»éƒµ: ${email}`);
        
        if (password.length < 4) {
          console.log('%câš ï¸  å¯†ç¢¼å¤ªçŸ­', 'color: #f59e0b;');
          showMessage('error', 'å¯†ç¢¼è‡³å°‘éœ€è¦4å€‹å­—å…ƒ');
          return;
        }
        
        const btn = document.getElementById('btnSignup');
        btn.disabled = true;
        btn.textContent = 'è™•ç†ä¸­...';
        
        try {
          const result = await LOGIN_MANAGER.register(username, password, email);
          console.log('ğŸ“¡ è¨»å†Šçµæœ:', result);
          
          if (result.success) {
            console.log('%câœ… è¨»å†ŠæˆåŠŸï¼', 'color: #10b981; font-size: 14px; font-weight: bold;');
            console.log(`ğŸ‰ æ­¡è¿åŠ å…¥ï¼Œ${username}ï¼`);
            
            showMessage('success', 'å¸³æˆ¶å»ºç«‹æˆåŠŸï¼æ­£åœ¨ç™»å…¥...');
            
            // â­ è¨»å†ŠæˆåŠŸå¾Œè‡ªå‹•ç™»å…¥ä¸¦è·³è½‰
            console.log('ğŸ”‘ è‡ªå‹•ç™»å…¥ä¸­...');
            const loginResult = await LOGIN_MANAGER.login(username, password);
            
            if (loginResult.success) {
              console.log('âœ… è‡ªå‹•ç™»å…¥æˆåŠŸ');
              console.log('ğŸ”€ æ­£åœ¨è·³è½‰è‡³ä¸»é ...');
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 1500);
            } else {
              console.log('âš ï¸  è‡ªå‹•ç™»å…¥å¤±æ•—ï¼Œè«‹æ‰‹å‹•ç™»å…¥');
              setTimeout(() => {
                switchToLogin();
              }, 2000);
            }
          } else {
            console.log('%câŒ è¨»å†Šå¤±æ•—', 'color: #ef4444; font-size: 14px; font-weight: bold;');
            console.log(`âš ï¸  åŸå› : ${result.message}`);
            showMessage('error', result.message || 'è¨»å†Šå¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡');
            btn.disabled = false;
            btn.textContent = 'å»ºç«‹å¸³æˆ¶';
          }
        } catch (error) {
          console.error('%câŒ è¨»å†ŠéŒ¯èª¤', 'color: #ef4444; font-size: 14px; font-weight: bold;');
          console.error('ğŸ› éŒ¯èª¤è©³æƒ…:', error);
          showMessage('error', 'è¨»å†Šéç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
          btn.disabled = false;
          btn.textContent = 'å»ºç«‹å¸³æˆ¶';
        }
      });

      // åˆ‡æ›è¡¨å–®
      document.getElementById('switchToSignup').addEventListener('click', () => {
        console.log('ğŸ”„ åˆ‡æ›è‡³è¨»å†Šè¡¨å–®');
        switchToSignup();
      });

      document.getElementById('switchToLogin').addEventListener('click', () => {
        console.log('ğŸ”„ åˆ‡æ›è‡³ç™»å…¥è¡¨å–®');
        switchToLogin();
      });

      console.log('%câœ… ç™»å…¥é é¢åˆå§‹åŒ–å®Œæˆ', 'color: #10b981; font-size: 14px; font-weight: bold;');
      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    }

    // é¡¯ç¤ºè¨Šæ¯
    function showMessage(type, text) {
      const errorMsg = document.getElementById('errorMsg');
      const successMsg = document.getElementById('successMsg');
      
      errorMsg.classList.remove('show');
      successMsg.classList.remove('show');
      
      if (type === 'error') {
        errorMsg.textContent = text;
        errorMsg.classList.add('show');
        console.log(`ğŸš¨ éŒ¯èª¤è¨Šæ¯: ${text}`);
      } else {
        successMsg.textContent = text;
        successMsg.classList.add('show');
        console.log(`âœ… æˆåŠŸè¨Šæ¯: ${text}`);
      }
    }

    // åˆ‡æ›è¡¨å–®
    function switchToSignup() {
      document.getElementById('loginSection').classList.remove('active');
      document.getElementById('signupSection').classList.add('active');
      document.getElementById('toSignupSection').style.display = 'none';
      document.getElementById('toLoginSection').style.display = 'block';
      document.getElementById('errorMsg').classList.remove('show');
      document.getElementById('successMsg').classList.remove('show');
    }

    function switchToLogin() {
      document.getElementById('signupSection').classList.remove('active');
      document.getElementById('loginSection').classList.add('active');
      document.getElementById('toLoginSection').style.display = 'none';
      document.getElementById('toSignupSection').style.display = 'block';
      document.getElementById('errorMsg').classList.remove('show');
      document.getElementById('successMsg').classList.remove('show');
    }

    // é é¢åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLoginPage);
    } else {
      initLoginPage();
    }
  </script>

</body>
</html>
