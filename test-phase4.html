<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 4 æ¨¡çµ„æ¸¬è©¦</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    .test-item {
      padding: 10px;
      margin: 5px 0;
      border-left: 3px solid #ddd;
      background: #f9f9f9;
    }
    .test-item.pass {
      border-left-color: #4CAF50;
      background: #e8f5e9;
    }
    .test-item.fail {
      border-left-color: #f44336;
      background: #ffebee;
    }
    .test-item.pending {
      border-left-color: #FF9800;
      background: #fff3e0;
    }
    pre {
      background: #263238;
      color: #aed581;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 10px;
    }
    .badge.pass { background: #4CAF50; color: white; }
    .badge.fail { background: #f44336; color: white; }
    .badge.pending { background: #FF9800; color: white; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Phase 4 æ¨¡çµ„æ¸¬è©¦</h1>
  
  <div class="test-section">
    <h2>1. æ¨¡çµ„è¼‰å…¥æ¸¬è©¦</h2>
    <div id="module-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>2. API å¯ç”¨æ€§æ¸¬è©¦</h2>
    <div id="api-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>3. é…ç½®æ¸¬è©¦</h2>
    <div id="config-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>4. å‘å¾Œç›¸å®¹æ¸¬è©¦</h2>
    <div id="compat-tests"></div>
  </div>
  
  <div class="test-section">
    <h2>5. Console è¼¸å‡º</h2>
    <pre id="console-output"></pre>
  </div>

  <script type="module">
    // æ•ç² console è¼¸å‡º
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    const logs = [];
    
    console.log = function(...args) {
      logs.push(args.join(' '));
      consoleOutput.textContent = logs.join('\n');
      originalLog.apply(console, args);
    };

    // æ¸¬è©¦è¼”åŠ©å‡½å¼
    function addTestResult(containerId, testName, passed, message = '') {
      const container = document.getElementById(containerId);
      const div = document.createElement('div');
      div.className = `test-item ${passed ? 'pass' : 'fail'}`;
      div.innerHTML = `
        <strong>${testName}</strong>
        <span class="badge ${passed ? 'pass' : 'fail'}">${passed ? 'âœ“ PASS' : 'âœ— FAIL'}</span>
        ${message ? `<br><small>${message}</small>` : ''}
      `;
      container.appendChild(div);
    }

    function addPendingTest(containerId, testName, message = '') {
      const container = document.getElementById(containerId);
      const div = document.createElement('div');
      div.className = 'test-item pending';
      div.innerHTML = `
        <strong>${testName}</strong>
        <span class="badge pending">â³ PENDING</span>
        ${message ? `<br><small>${message}</small>` : ''}
      `;
      container.appendChild(div);
    }

    // é–‹å§‹æ¸¬è©¦
    console.log('='.repeat(60));
    console.log('é–‹å§‹ Phase 4 æ¨¡çµ„æ¸¬è©¦');
    console.log('='.repeat(60));

    // æ¸¬è©¦ 1: æ¨¡çµ„è¼‰å…¥
    console.log('\n[æ¸¬è©¦ 1] æ¨¡çµ„è¼‰å…¥æ¸¬è©¦');
    
    try {
      const { APP_CONFIG } = await import('./src/init/config.js');
      addTestResult('module-tests', 'config.js è¼‰å…¥', true, 'APP_CONFIG å·²è¼‰å…¥');
      console.log('âœ“ config.js è¼‰å…¥æˆåŠŸ');
    } catch (error) {
      addTestResult('module-tests', 'config.js è¼‰å…¥', false, error.message);
      console.error('âœ— config.js è¼‰å…¥å¤±æ•—:', error);
    }

    try {
      const { AppInit } = await import('./src/init/app-init.js');
      addTestResult('module-tests', 'app-init.js è¼‰å…¥', true, 'AppInit å·²è¼‰å…¥');
      console.log('âœ“ app-init.js è¼‰å…¥æˆåŠŸ');
    } catch (error) {
      addTestResult('module-tests', 'app-init.js è¼‰å…¥', false, error.message);
      console.error('âœ— app-init.js è¼‰å…¥å¤±æ•—:', error);
    }

    try {
      const { LoginPageInit } = await import('./src/init/login-page-init.js');
      addTestResult('module-tests', 'login-page-init.js è¼‰å…¥', true, 'LoginPageInit å·²è¼‰å…¥');
      console.log('âœ“ login-page-init.js è¼‰å…¥æˆåŠŸ');
    } catch (error) {
      addTestResult('module-tests', 'login-page-init.js è¼‰å…¥', false, error.message);
      console.error('âœ— login-page-init.js è¼‰å…¥å¤±æ•—:', error);
    }

    try {
      const mainModule = await import('./src/main.js');
      addTestResult('module-tests', 'main.js è¼‰å…¥', true, `åŒ¯å‡º ${Object.keys(mainModule).length} å€‹ API`);
      console.log('âœ“ main.js è¼‰å…¥æˆåŠŸ');
    } catch (error) {
      addTestResult('module-tests', 'main.js è¼‰å…¥', false, error.message);
      console.error('âœ— main.js è¼‰å…¥å¤±æ•—:', error);
    }

    try {
      const legacyBridge = await import('./src/compat/legacy-bridge.js');
      addTestResult('module-tests', 'legacy-bridge.js è¼‰å…¥', true, 'legacyAPI å·²è¼‰å…¥');
      console.log('âœ“ legacy-bridge.js è¼‰å…¥æˆåŠŸ');
    } catch (error) {
      addTestResult('module-tests', 'legacy-bridge.js è¼‰å…¥', false, error.message);
      console.error('âœ— legacy-bridge.js è¼‰å…¥å¤±æ•—:', error);
    }

    // æ¸¬è©¦ 2: API å¯ç”¨æ€§
    console.log('\n[æ¸¬è©¦ 2] API å¯ç”¨æ€§æ¸¬è©¦');
    
    try {
      const { initApp, initLoginPage, getAppInfo } = await import('./src/main.js');
      
      addTestResult('api-tests', 'initApp å‡½å¼', typeof initApp === 'function', `type: ${typeof initApp}`);
      addTestResult('api-tests', 'initLoginPage å‡½å¼', typeof initLoginPage === 'function', `type: ${typeof initLoginPage}`);
      addTestResult('api-tests', 'getAppInfo å‡½å¼', typeof getAppInfo === 'function', `type: ${typeof getAppInfo}`);
      
      const appInfo = getAppInfo();
      addTestResult('api-tests', 'getAppInfo() åŸ·è¡Œ', appInfo && appInfo.version === '3.0.0', `version: ${appInfo?.version}`);
      
      console.log('âœ“ ä¸»è¦ API å‡½å¼å¯ç”¨');
    } catch (error) {
      addTestResult('api-tests', 'API æ¸¬è©¦', false, error.message);
      console.error('âœ— API æ¸¬è©¦å¤±æ•—:', error);
    }

    // æ¸¬è©¦ 3: é…ç½®
    console.log('\n[æ¸¬è©¦ 3] é…ç½®æ¸¬è©¦');
    
    try {
      const { APP_CONFIG, getConfig, validateConfig } = await import('./src/init/config.js');
      
      addTestResult('config-tests', 'APP_CONFIG.APP_NAME', APP_CONFIG.APP_NAME === 'RS-System', `å€¼: ${APP_CONFIG.APP_NAME}`);
      addTestResult('config-tests', 'APP_CONFIG.APP_VERSION', APP_CONFIG.APP_VERSION === '3.0.0', `å€¼: ${APP_CONFIG.APP_VERSION}`);
      addTestResult('config-tests', 'APP_CONFIG.FEATURES', typeof APP_CONFIG.FEATURES === 'object', `keys: ${Object.keys(APP_CONFIG.FEATURES).length}`);
      
      const devConfig = getConfig('development');
      addTestResult('config-tests', 'getConfig("development")', devConfig.DEBUG === true, `DEBUG: ${devConfig.DEBUG}`);
      
      const isValid = validateConfig(APP_CONFIG);
      addTestResult('config-tests', 'validateConfig()', isValid === true, `çµæœ: ${isValid}`);
      
      console.log('âœ“ é…ç½®æ¸¬è©¦é€šé');
    } catch (error) {
      addTestResult('config-tests', 'é…ç½®æ¸¬è©¦', false, error.message);
      console.error('âœ— é…ç½®æ¸¬è©¦å¤±æ•—:', error);
    }

    // æ¸¬è©¦ 4: å‘å¾Œç›¸å®¹
    console.log('\n[æ¸¬è©¦ 4] å‘å¾Œç›¸å®¹æ¸¬è©¦');
    
    try {
      const { setupLegacyGlobals, legacyAPI, getMigrationStatus } = await import('./src/compat/legacy-bridge.js');
      
      addTestResult('compat-tests', 'setupLegacyGlobals å‡½å¼', typeof setupLegacyGlobals === 'function', 'å¯ç”¨');
      addTestResult('compat-tests', 'legacyAPI ç‰©ä»¶', typeof legacyAPI === 'object', `keys: ${Object.keys(legacyAPI).length}`);
      addTestResult('compat-tests', 'getMigrationStatus å‡½å¼', typeof getMigrationStatus === 'function', 'å¯ç”¨');
      
      const status = getMigrationStatus();
      addTestResult('compat-tests', 'getMigrationStatus()', status && typeof status.warningsCount === 'number', `warnings: ${status?.warningsCount}`);
      
      console.log('âœ“ å‘å¾Œç›¸å®¹å±¤æ¸¬è©¦é€šé');
    } catch (error) {
      addTestResult('compat-tests', 'å‘å¾Œç›¸å®¹æ¸¬è©¦', false, error.message);
      console.error('âœ— å‘å¾Œç›¸å®¹æ¸¬è©¦å¤±æ•—:', error);
    }

    // Phase 1-3 æ¨¡çµ„æª¢æŸ¥
    console.log('\n[ä¿¡æ¯] Phase 1-3 æ¨¡çµ„ç‹€æ…‹');
    addPendingTest('module-tests', 'Phase 1-3 æ¨¡çµ„', 'å¾…å¯¦ç¾ï¼šconstants, utils, core, services, ui');

    console.log('\n' + '='.repeat(60));
    console.log('æ¸¬è©¦å®Œæˆï¼');
    console.log('='.repeat(60));
  </script>
</body>
</html>
