<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¨¡çµ„æ¸¬è©¦ - Module Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #2196f3;
      padding-bottom: 10px;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-section h2 {
      color: #2196f3;
      margin-top: 0;
    }
    .result {
      background: #f9f9f9;
      padding: 10px;
      border-left: 4px solid #4caf50;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #1976d2;
    }
    #test-element {
      padding: 10px;
      background: #e3f2fd;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>ğŸš€ RS-System æ¨¡çµ„åŒ–å·¥å…·æ¸¬è©¦</h1>

  <div class="test-section">
    <h2>1. å¸¸æ•¸æ¨¡çµ„æ¸¬è©¦</h2>
    <div id="constants-test" class="result"></div>
  </div>

  <div class="test-section">
    <h2>2. DOM å·¥å…·æ¸¬è©¦</h2>
    <div id="test-element">é€™æ˜¯æ¸¬è©¦å…ƒç´ </div>
    <button id="dom-test-btn">æ¸¬è©¦ DOM é¸æ“‡å™¨</button>
    <div id="dom-test" class="result"></div>
  </div>

  <div class="test-section">
    <h2>3. è¼”åŠ©å‡½æ•¸æ¸¬è©¦</h2>
    <button id="toast-info">é¡¯ç¤º Info Toast</button>
    <button id="toast-success">é¡¯ç¤º Success Toast</button>
    <button id="toast-error">é¡¯ç¤º Error Toast</button>
    <div id="helpers-test" class="result"></div>
  </div>

  <div class="test-section">
    <h2>4. æ ¼å¼åŒ–å·¥å…·æ¸¬è©¦</h2>
    <div id="formatters-test" class="result"></div>
  </div>

  <div class="test-section">
    <h2>5. é©—è­‰å·¥å…·æ¸¬è©¦</h2>
    <div id="validators-test" class="result"></div>
  </div>

  <script type="module">
    // å°å…¥æ‰€æœ‰æ¨¡çµ„
    import { STORAGE_KEY, RANGE_IDS, STORAGE_VERSION, DEFAULT_CACHE_TTL } from '../../src/constants/app-constants.js';
    import { $, $q, $qa } from '../../src/utils/dom-utils.js';
    import { escapeHtml, toast, todayStr } from '../../src/utils/helpers.js';
    import { formatFileSize, timeToMinutes, minutesToTime } from '../../src/utils/formatters.js';
    import { isRequired, isValidDate, isValidTime, isInRange } from '../../src/utils/validators.js';

    // æ¸¬è©¦ 1: å¸¸æ•¸æ¨¡çµ„
    const constantsDiv = $('constants-test');
    constantsDiv.innerHTML = `
      <strong>STORAGE_KEY:</strong> ${STORAGE_KEY}<br>
      <strong>STORAGE_VERSION:</strong> ${STORAGE_VERSION}<br>
      <strong>DEFAULT_CACHE_TTL:</strong> ${DEFAULT_CACHE_TTL} ms<br>
      <strong>RANGE_IDS:</strong> ${RANGE_IDS.join(', ')}<br>
    `;

    // æ¸¬è©¦ 2: DOM å·¥å…·
    $('dom-test-btn').addEventListener('click', () => {
      const element = $('test-element');
      const button = $q('#dom-test-btn');
      const allDivs = $qa('div').length;
      
      const domDiv = $('dom-test');
      domDiv.innerHTML = `
        <strong>$('test-element'):</strong> ${element ? 'âœ… æ‰¾åˆ°å…ƒç´ ' : 'âŒ æœªæ‰¾åˆ°'}<br>
        <strong>$q('#dom-test-btn'):</strong> ${button ? 'âœ… æ‰¾åˆ°æŒ‰éˆ•' : 'âŒ æœªæ‰¾åˆ°'}<br>
        <strong>$qa('div').length:</strong> ${allDivs} å€‹ div å…ƒç´ 
      `;
    });

    // æ¸¬è©¦ 3: è¼”åŠ©å‡½æ•¸
    $('toast-info').addEventListener('click', () => toast('é€™æ˜¯ä¸€å€‹è³‡è¨Šæç¤º', 'info'));
    $('toast-success').addEventListener('click', () => toast('æ“ä½œæˆåŠŸï¼', 'success'));
    $('toast-error').addEventListener('click', () => toast('ç™¼ç”ŸéŒ¯èª¤ï¼', 'error'));

    const helpersDiv = $('helpers-test');
    const dangerousText = '<scr' + 'ipt>alert("XSS")</scr' + 'ipt>';
    const escapedText = escapeHtml(dangerousText);
    const today = todayStr();
    
    helpersDiv.innerHTML = `
      <strong>escapeHtml():</strong><br>
      åŸå§‹: ${dangerousText}<br>
      è½‰ç¾©å¾Œ: ${escapedText}<br><br>
      <strong>todayStr():</strong> ${today}
    `;

    // æ¸¬è©¦ 4: æ ¼å¼åŒ–å·¥å…·
    const formattersDiv = $('formatters-test');
    const testSizes = [0, 500, 1024, 1024 * 1024, 1024 * 1024 * 5.5];
    const sizeResults = testSizes.map(bytes => 
      `${bytes} bytes = ${formatFileSize(bytes)}`
    ).join('<br>');

    const time1 = '02:30';
    const minutes1 = timeToMinutes(time1);
    const time2 = minutesToTime(150);

    formattersDiv.innerHTML = `
      <strong>formatFileSize():</strong><br>
      ${sizeResults}<br><br>
      <strong>timeToMinutes('${time1}'):</strong> ${minutes1} åˆ†é˜<br>
      <strong>minutesToTime(150):</strong> ${time2}
    `;

    // æ¸¬è©¦ 5: é©—è­‰å·¥å…·
    const validatorsDiv = $('validators-test');
    const tests = [
      { fn: 'isRequired', tests: [
        { value: 'hello', result: isRequired('hello') },
        { value: '   ', result: isRequired('   ') },
        { value: null, result: isRequired(null) }
      ]},
      { fn: 'isValidDate', tests: [
        { value: '2026-02-17', result: isValidDate('2026-02-17') },
        { value: '2026-13-01', result: isValidDate('2026-13-01') },
        { value: 'not-a-date', result: isValidDate('not-a-date') }
      ]},
      { fn: 'isValidTime', tests: [
        { value: '14:30', result: isValidTime('14:30') },
        { value: '25:00', result: isValidTime('25:00') },
        { value: '12:99', result: isValidTime('12:99') }
      ]},
      { fn: 'isInRange', tests: [
        { value: '5 in [1,10]', result: isInRange(5, 1, 10) },
        { value: '15 in [1,10]', result: isInRange(15, 1, 10) },
        { value: '1 in [1,10]', result: isInRange(1, 1, 10) }
      ]}
    ];

    let validatorsHTML = '';
    tests.forEach(({ fn, tests }) => {
      validatorsHTML += `<strong>${fn}():</strong><br>`;
      tests.forEach(({ value, result }) => {
        validatorsHTML += `  ${value}: ${result ? 'âœ…' : 'âŒ'}<br>`;
      });
      validatorsHTML += '<br>';
    });

    validatorsDiv.innerHTML = validatorsHTML;

    console.log('âœ… æ‰€æœ‰æ¨¡çµ„æ¸¬è©¦å®Œæˆ');
    console.log('Storage Key:', STORAGE_KEY);
    console.log('Today:', today);
  </script>
</body>
</html>
