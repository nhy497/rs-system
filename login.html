<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HKJRA æ•™ç·´è¨˜éŒ„ç³»çµ± Â· ç™»å…¥</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .login-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 420px;
      padding: 2.5rem;
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .login-header h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: #1e293b;
      font-weight: 700;
    }
    
    .login-header p {
      color: #64748b;
      font-size: 0.95rem;
    }
    
    .message {
      margin-bottom: 1rem;
      padding: 0.75rem;
      border-radius: 6px;
      border-left: 4px solid;
      display: none;
      font-size: 0.85rem;
    }
    
    .error-msg {
      background: #fee2e2;
      color: #dc2626;
      border-left-color: #dc2626;
    }
    
    .success-msg {
      background: #d1fae5;
      color: #059669;
      border-left-color: #059669;
    }
    
    .message.show {
      display: block;
    }
    
    .form-section {
      display: none;
    }
    
    .form-section.active {
      display: block;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    
    .form-group label {
      font-weight: 500;
      color: #1e293b;
      font-size: 0.9rem;
    }
    
    .form-group input {
      padding: 0.7rem 0.9rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-group input::placeholder {
      color: #cbd5e1;
    }
    
    .btn-login {
      padding: 0.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 0.5rem;
      font-family: inherit;
    }
    
    .btn-login:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-login:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .toggle-form {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e8f0;
    }
    
    .toggle-form p {
      color: #64748b;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }
    
    .btn-toggle {
      color: #667eea;
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: underline;
      font-size: 0.9rem;
      font-weight: 600;
      font-family: inherit;
    }
    
    .btn-toggle:hover {
      color: #764ba2;
    }
    
    .mode-indicator {
      text-align: center;
      color: #cbd5e1;
      font-size: 0.75rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <h1>â—‡ æ•™ç·´è¨˜éŒ„ç³»çµ±</h1>
      <p> è·³ç¹©èª²å ‚ç®¡ç†å¹³è‡º</p>
    </div>
    
    <div class="error-msg message" id="errorMsg"></div>
    <div class="success-msg message" id="successMsg"></div>
    
    <!-- ç™»å…¥è¡¨å–® -->
    <div id="loginSection" class="form-section active">
      <form class="login-form" id="loginForm">
        <div class="form-group">
          <label for="loginUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="loginUsername" placeholder="è¼¸å…¥æ‚¨çš„ä½¿ç”¨è€…åç¨±" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">å¯†ç¢¼</label>
          <input type="password" id="loginPassword" placeholder="è¼¸å…¥æ‚¨çš„å¯†ç¢¼" required>
        </div>
        <button type="submit" class="btn-login" id="btnLogin">ç™»å…¥</button>
      </form>
    </div>
    
    <!-- è¨»å†Šè¡¨å–® -->
    <div id="signupSection" class="form-section">
      <form class="login-form" id="signupForm">
        <div class="form-group">
          <label for="signupUsername">ä½¿ç”¨è€…åç¨±</label>
          <input type="text" id="signupUsername" placeholder="å»ºç«‹æ–°çš„ä½¿ç”¨è€…åç¨±" required>
        </div>
        <div class="form-group">
          <label for="signupPassword">å¯†ç¢¼</label>
          <input type="password" id="signupPassword" placeholder="å»ºç«‹æ–°å¯†ç¢¼ (æœ€å°‘4å€‹å­—)" required>
        </div>
        <div class="form-group">
          <label for="signupEmail">é›»éƒµ <span style="color: #999;">(å¯é¸)</span></label>
          <input type="email" id="signupEmail" placeholder="æ‚¨çš„é›»éƒµåœ°å€ (å¯é¸)">
        </div>
        <button type="submit" class="btn-login" id="btnSignup">å»ºç«‹å¸³æˆ¶</button>
      </form>
    </div>
    
    <!-- è¡¨å–®åˆ‡æ› -->
    <div class="toggle-form">
      <div id="toSignupSection" style="display: block;">
        <p>æ²’æœ‰å¸³æˆ¶?</p>
        <button type="button" class="btn-toggle" id="switchToSignup">å»ºç«‹æ–°å¸³æˆ¶</button>
      </div>
      <div id="toLoginSection" style="display: none;">
        <p>å·²æœ‰å¸³æˆ¶?</p>
        <button type="button" class="btn-toggle" id="switchToLogin">è¿”å›ç™»å…¥</button>
      </div>
    </div>
    
    <div class="mode-indicator">æœ¬åœ°å­˜å„²æ¨¡å¼ Â· HKJRA v3.1</div>
  </div>

  <!-- ç³»çµ±æ ¸å¿ƒæ¨¡çµ„ï¼ˆæ•´åˆç‰ˆ v3.1ï¼‰ -->
  <script src="system.js"></script>
  
  <script>
    // ç™»å…¥é é¢åˆå§‹åŒ–æª¢æŸ¥ - èˆ‡ system-test.js é‚è¼¯ä¸€è‡´
    (function() {
      console.log('ğŸ” ç™»å…¥é é¢å·²è¼‰å…¥ - HKJRA æ•™ç·´è¨˜éŒ„ç³»çµ± v3.1');
      console.log('ğŸ“Š LocalStorage å¯ç”¨:', typeof localStorage !== 'undefined');
      console.log('ğŸ“Š ç³»çµ±æ¨¡çµ„åŠ è¼‰:', typeof LOGIN_MANAGER !== 'undefined');
      
      // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥ - èˆ‡ system-test.js ç›¸åŒçš„æª¢æŸ¥é‚è¼¯
      try {
        const session = localStorage.getItem('rs-system-session');
        const user = localStorage.getItem('current-user');
        
        if (session && user) {
          try {
            const sessionData = JSON.parse(session);
            const userData = JSON.parse(user);
            
            // é©—è­‰å¿…è¦æ¬„ä½ - ç¢ºä¿æ•¸æ“šçµæ§‹å®Œæ•´
            if (!sessionData.userId || !sessionData.sessionId || !userData.id) {
              console.warn('âš ï¸ æœƒè©±æ•¸æ“šä¸å®Œæ•´ï¼Œæ¸…é™¤ä¸¦é‡æ–°ç™»å…¥');
              localStorage.removeItem('rs-system-session');
              localStorage.removeItem('current-user');
              return;
            }
            
            // å¦‚æœæœƒè©±æœ‰æ•ˆï¼Œé‡å®šå‘åˆ°ä¸»é é¢
            if (sessionData.expiresAt && Date.now() < sessionData.expiresAt) {
              console.log('âœ… æª¢æ¸¬åˆ°æœ‰æ•ˆæœƒè©±');
              console.log('ğŸ“Š ç”¨æˆ¶:', userData.username, '| è§’è‰²:', userData.role || 'user');
              console.log('ğŸ“Š æœƒè©±ID:', sessionData.sessionId);
              console.log('â° å‰©é¤˜æ™‚é–“:', Math.round((sessionData.expiresAt - Date.now()) / 3600000), 'å°æ™‚');
              console.log('ğŸ”„ é‡å®šå‘åˆ°ä¸»é é¢...');
              
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 500);
            } else {
              console.warn('âš ï¸ æœƒè©±å·²éæœŸï¼Œæ¸…é™¤æ•¸æ“š');
              localStorage.removeItem('rs-system-session');
              localStorage.removeItem('current-user');
            }
          } catch (parseError) {
            console.error('âš ï¸ æœƒè©±æ•¸æ“šæ ¼å¼éŒ¯èª¤:', parseError);
            localStorage.removeItem('rs-system-session');
            localStorage.removeItem('current-user');
          }
        } else {
          console.log('ğŸ“ æœªæª¢æ¸¬åˆ°æœƒè©±ï¼Œé¡¯ç¤ºç™»å…¥è¡¨å–®');
        }
      } catch (error) {
        console.warn('âš ï¸ æœƒè©±æª¢æŸ¥å¤±æ•—:', error);
      }
      
      // é¡¯ç¤ºç³»çµ±ä¿¡æ¯
      try {
        const users = localStorage.getItem('users');
        if (users) {
          const usersList = JSON.parse(users);
          console.log('ğŸ‘¥ ç³»çµ±ç”¨æˆ¶æ•¸:', usersList.length);
        } else {
          console.log('ğŸ‘¥ ç³»çµ±ç”¨æˆ¶æ•¸: 0 (é¦–æ¬¡ä½¿ç”¨)');
        }
      } catch (error) {
        console.warn('âš ï¸ ç„¡æ³•è®€å–ç”¨æˆ¶åˆ—è¡¨');
      }
    })();
  </script>
</body>
</html>
