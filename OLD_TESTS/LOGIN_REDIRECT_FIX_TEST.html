<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™»å…¥é‡å®šå‘å•é¡Œä¿®å¾©é©—è­‰</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      padding: 30px;
    }
    .header {
      border-bottom: 3px solid #667eea;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }
    .header h1 {
      color: #333;
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    .header p {
      color: #666;
    }
    .test-section {
      margin-bottom: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      border-radius: 6px;
    }
    .test-section h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.2em;
    }
    .test-steps {
      background: white;
      padding: 15px;
      border-radius: 6px;
      margin-top: 10px;
    }
    .test-step {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      gap: 15px;
    }
    .test-step:last-child {
      border-bottom: none;
    }
    .step-num {
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    .step-content {
      flex: 1;
    }
    .step-content strong {
      color: #333;
    }
    .step-content p {
      color: #666;
      font-size: 0.9em;
      margin-top: 5px;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .log {
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-top: 10px;
    }
    .status.pass {
      background: #d4edda;
      color: #155724;
    }
    .status.fail {
      background: #f8d7da;
      color: #721c24;
    }
    .status.pending {
      background: #fff3cd;
      color: #856404;
    }
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      color: #1565c0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”§ ç™»å…¥é‡å®šå‘å•é¡Œä¿®å¾©é©—è­‰</h1>
      <p>é©—è­‰ç™»å…¥å¾Œä¸æœƒè‡ªå‹•é‡å®šå‘å› login.html çš„ä¿®å¾©</p>
    </div>

    <div class="info-box">
      <strong>ğŸ“‹ ä¿®å¾©èªªæ˜ï¼š</strong><br>
      ç³»çµ±å·²ä¿®å¾©æœƒè©±æª¢æŸ¥é‚è¼¯ï¼Œæ”¹é€²äº† ipHash é©—è­‰æ©Ÿåˆ¶ï¼Œç¢ºä¿ç™»å…¥å¾Œèƒ½æˆåŠŸé€²å…¥ index.htmlï¼Œä¸æœƒè¢«è‡ªå‹•è¸¢å› login.htmlã€‚
    </div>

    <!-- æ¸¬è©¦ 1: æœƒè©±æª¢æŸ¥é‚è¼¯é©—è­‰ -->
    <div class="test-section">
      <h3>âœ… æ¸¬è©¦ 1: æœƒè©±æª¢æŸ¥é‚è¼¯é©—è­‰</h3>
      <div class="test-steps">
        <div class="test-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <strong>æª¢æŸ¥ localStorage ä¸­çš„æœƒè©±æ•¸æ“šçµæ§‹</strong>
            <p>é©—è­‰ rs-system-session åŒ…å«å¿…è¦æ¬„ä½ï¼šuserIdã€sessionIdã€expiresAt</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <strong>é©—è­‰æœƒè©±éæœŸæª¢æŸ¥</strong>
            <p>ç¢ºèªç³»çµ±åƒ…åœ¨æœƒè©±çœŸæ­£éæœŸæ™‚æ‰ç™»å‡º</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <strong>ç§»é™¤éæ–¼åš´æ ¼çš„ ipHash é©—è­‰</strong>
            <p>å…è¨±ä¸åŒè¨­å‚™ç’°å¢ƒä¸‹æœƒè©±ä»ç„¶æœ‰æ•ˆ</p>
          </div>
        </div>
      </div>
      <div class="controls">
        <button onclick="testSessionStructure()">æª¢æŸ¥æœƒè©±çµæ§‹</button>
      </div>
      <div id="test1-log" class="log" style="display:none;"></div>
      <div id="test1-status"></div>
    </div>

    <!-- æ¸¬è©¦ 2: ç™»å…¥æµç¨‹æ¸¬è©¦ -->
    <div class="test-section">
      <h3>âœ… æ¸¬è©¦ 2: ç™»å…¥æµç¨‹æ¸¬è©¦</h3>
      <div class="test-steps">
        <div class="test-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <strong>æº–å‚™æ¸¬è©¦ç”¨æˆ¶</strong>
            <p>å»ºç«‹æ¸¬è©¦å¸³è™Ÿç”¨æ–¼é©—è­‰ç™»å…¥æµç¨‹</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <strong>åŸ·è¡Œç™»å…¥æ“ä½œ</strong>
            <p>æ¨¡æ“¬ç”¨æˆ¶ç™»å…¥ä¸¦é©—è­‰æœƒè©±ä¿å­˜</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <strong>é©—è­‰ index.html æœƒè©±æª¢æŸ¥</strong>
            <p>ç¢ºèª index.html ä¸æœƒå› æœƒè©±æª¢æŸ¥å¤±æ•—è€Œé‡å®šå‘</p>
          </div>
        </div>
      </div>
      <div class="controls">
        <button onclick="testLoginFlow()">æ¸¬è©¦ç™»å…¥æµç¨‹</button>
      </div>
      <div id="test2-log" class="log" style="display:none;"></div>
      <div id="test2-status"></div>
    </div>

    <!-- æ¸¬è©¦ 3: æœƒè©±é©—è­‰é‚è¼¯ -->
    <div class="test-section">
      <h3>âœ… æ¸¬è©¦ 3: æ”¹é€²çš„æœƒè©±é©—è­‰é‚è¼¯</h3>
      <div class="test-steps">
        <div class="test-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <strong>æª¢æŸ¥ index.html çš„æœƒè©±é©—è­‰ä»£ç¢¼</strong>
            <p>é©—è­‰æœƒè©±æª¢æŸ¥çš„å¤šå±¤é©—è­‰é‚è¼¯</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <strong>æ¨¡æ“¬æœƒè©±éæœŸå ´æ™¯</strong>
            <p>é©—è­‰åªæœ‰åœ¨æœƒè©±çœŸæ­£éæœŸæ™‚æ‰é‡å®šå‘</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <strong>é©—è­‰æ­£å¸¸æœƒè©±å ´æ™¯</strong>
            <p>ç¢ºèªæœ‰æ•ˆçš„æœƒè©±å…è¨±è¨ªå• index.html</p>
          </div>
        </div>
      </div>
      <div class="controls">
        <button onclick="testSessionValidation()">æ¸¬è©¦æœƒè©±é©—è­‰</button>
      </div>
      <div id="test3-log" class="log" style="display:none;"></div>
      <div id="test3-status"></div>
    </div>

    <!-- æ¸¬è©¦ 4: å®Œæ•´ç™»å…¥åˆ° index.html æµç¨‹ -->
    <div class="test-section">
      <h3>âœ… æ¸¬è©¦ 4: å®Œæ•´æµç¨‹æ¨¡æ“¬</h3>
      <div class="test-steps">
        <div class="test-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <strong>æ¸…é™¤ç¾æœ‰æœƒè©±</strong>
            <p>ç§»é™¤ localStorage ä¸­çš„æ‰€æœ‰æœƒè©±æ•¸æ“š</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <strong>æ¨¡æ“¬ç™»å…¥ï¼ˆä¿å­˜æœƒè©±ï¼‰</strong>
            <p>ä¿å­˜å®Œæ•´çš„æœƒè©±æ•¸æ“šåˆ° localStorage</p>
          </div>
        </div>
        <div class="test-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <strong>é©—è­‰æœƒè©±åœ¨ index.html çš„æª¢æŸ¥</strong>
            <p>åŸ·è¡Œ index.html çš„æœƒè©±æª¢æŸ¥é‚è¼¯ï¼Œç¢ºèªä¸æœƒé‡å®šå‘</p>
          </div>
        </div>
      </div>
      <div class="controls">
        <button onclick="testCompleteFlow()">åŸ·è¡Œå®Œæ•´æµç¨‹æ¨¡æ“¬</button>
      </div>
      <div id="test4-log" class="log" style="display:none;"></div>
      <div id="test4-status"></div>
    </div>

    <!-- ä¿®å¾©ç¸½çµ -->
    <div class="test-section" style="background: #d4edda; border-left-color: #28a745;">
      <h3 style="color: #155724;">ğŸ“ ä¿®å¾©ç¸½çµ</h3>
      <p><strong>å•é¡Œï¼š</strong> ç™»å…¥å¾Œè¢«è‡ªå‹•é‡å®šå‘å› login.html</p>
      <p><strong>æ ¹æœ¬åŸå› ï¼š</strong></p>
      <ul style="margin: 10px 0 10px 20px; color: #333;">
        <li>ipHash é©—è­‰éæ–¼åš´æ ¼ï¼ˆä¸åŒæ™‚æ©Ÿè¨ˆç®—çš„å€¼å¯èƒ½ä¸åŒï¼‰</li>
        <li>æœƒè©±æ•¸æ“šçµæ§‹ä¸å®Œæ•´ï¼ˆç¼ºå°‘ sessionIdã€expiresAtï¼‰</li>
        <li>index.html çš„æœƒè©±æª¢æŸ¥é‚è¼¯ä¸å¤ å¥å…¨</li>
      </ul>
      <p><strong>ä¿®å¾©æ–¹æ¡ˆï¼š</strong></p>
      <ul style="margin: 10px 0 10px 20px; color: #333;">
        <li>âœ… æ”¹é€² checkSession() é‚è¼¯ï¼ŒipHash é©—è­‰ä¸å†ç›´æ¥å°è‡´ç™»å‡º</li>
        <li>âœ… å®Œå–„ç™»å…¥æ™‚çš„æœƒè©±æ•¸æ“šçµæ§‹ï¼ˆæ·»åŠ  sessionIdã€expiresAtï¼‰</li>
        <li>âœ… å¢å¼· index.html çš„æœƒè©±æª¢æŸ¥ï¼Œå¤šå±¤é©—è­‰ç¢ºä¿æ•¸æ“šæœ‰æ•ˆæ€§</li>
        <li>âœ… å¯¦ç¾æœƒè©±æ•¸æ“šé©—è­‰é‡è©¦æ©Ÿåˆ¶</li>
      </ul>
    </div>

  </div>

  <script>
    // æ—¥èªŒè¼¸å‡ºå‡½æ•¸
    function addLog(elementId, message, level = 'info') {
      const logElement = document.getElementById(elementId);
      logElement.style.display = 'block';
      const timestamp = new Date().toLocaleTimeString('zh-TW');
      const prefix = {
        'info': 'â„¹ï¸ ',
        'success': 'âœ… ',
        'error': 'âŒ ',
        'warn': 'âš ï¸ '
      }[level] || '';
      logElement.textContent += `[${timestamp}] ${prefix}${message}\n`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    function setStatus(elementId, message, status) {
      const statusElement = document.getElementById(elementId);
      statusElement.className = `status ${status}`;
      statusElement.textContent = message;
    }

    // æ¸¬è©¦ 1: æœƒè©±çµæ§‹æª¢æŸ¥
    function testSessionStructure() {
      const logId = 'test1-log';
      const statusId = 'test1-status';
      const logElement = document.getElementById(logId);
      logElement.textContent = '';
      logElement.style.display = 'block';

      addLog(logId, 'é–‹å§‹æª¢æŸ¥æœƒè©±çµæ§‹...', 'info');

      const session = localStorage.getItem('rs-system-session');
      const currentUser = localStorage.getItem('current-user');

      if (!session || !currentUser) {
        addLog(logId, 'æœªæ‰¾åˆ°æœƒè©±æ•¸æ“šã€‚è«‹å…ˆåŸ·è¡Œç™»å…¥ã€‚', 'warn');
        setStatus(statusId, 'âš ï¸ æœªæ‰¾åˆ°æœƒè©±æ•¸æ“š', 'pending');
        return;
      }

      try {
        const sessionData = JSON.parse(session);
        const userData = JSON.parse(currentUser);

        addLog(logId, 'æœƒè©±æ•¸æ“šè§£ææˆåŠŸ', 'success');
        addLog(logId, `userId: ${sessionData.userId || 'âŒ ç¼ºå¤±'}`, sessionData.userId ? 'success' : 'error');
        addLog(logId, `sessionId: ${sessionData.sessionId || 'âŒ ç¼ºå¤±'}`, sessionData.sessionId ? 'success' : 'error');
        addLog(logId, `expiresAt: ${sessionData.expiresAt ? new Date(sessionData.expiresAt).toLocaleString('zh-TW') : 'âŒ ç¼ºå¤±'}`, sessionData.expiresAt ? 'success' : 'error');
        addLog(logId, `current-user.id: ${userData.id || 'âŒ ç¼ºå¤±'}`, userData.id ? 'success' : 'error');

        const isValid = sessionData.userId && sessionData.sessionId && userData.id;
        addLog(logId, isValid ? 'âœ… æœƒè©±çµæ§‹å®Œæ•´' : 'âŒ æœƒè©±çµæ§‹ä¸å®Œæ•´', isValid ? 'success' : 'error');
        setStatus(statusId, isValid ? 'âœ… é€šé' : 'âŒ å¤±æ•—', isValid ? 'pass' : 'fail');
      } catch (error) {
        addLog(logId, `JSON è§£æå¤±æ•—: ${error.message}`, 'error');
        setStatus(statusId, 'âŒ JSON è§£æå¤±æ•—', 'fail');
      }
    }

    // æ¸¬è©¦ 2: ç™»å…¥æµç¨‹
    function testLoginFlow() {
      const logId = 'test2-log';
      const statusId = 'test2-status';
      const logElement = document.getElementById(logId);
      logElement.textContent = '';
      logElement.style.display = 'block';

      addLog(logId, 'é–‹å§‹æ¸¬è©¦ç™»å…¥æµç¨‹...', 'info');

      // æº–å‚™æ¸¬è©¦ç”¨æˆ¶
      const testUser = {
        id: 'test_user_001',
        username: 'testuser',
        password: 'test1234',
        email: 'test@example.com',
        role: 'user'
      };

      addLog(logId, `æº–å‚™æ¸¬è©¦ç”¨æˆ¶: ${testUser.username}`, 'info');

      // ä¿å­˜ç”¨æˆ¶åˆ° users åˆ—è¡¨
      let users = JSON.parse(localStorage.getItem('users') || '[]');
      users = users.filter(u => u.username !== testUser.username);
      users.push(testUser);
      localStorage.setItem('users', JSON.stringify(users));
      addLog(logId, 'æ¸¬è©¦ç”¨æˆ¶å·²ä¿å­˜åˆ° localStorage', 'success');

      // æ¨¡æ“¬ç™»å…¥
      const currentTime = Date.now();
      const sessionTimeout = 24 * 60 * 60 * 1000;

      const sessionData = {
        userId: testUser.id,
        username: testUser.username,
        sessionId: `session_${currentTime}_${Math.random().toString(36).substr(2, 9)}`,
        createdAt: currentTime,
        expiresAt: currentTime + sessionTimeout,
        role: testUser.role
      };

      const userData = {
        id: testUser.id,
        username: testUser.username,
        email: testUser.email,
        role: testUser.role,
        loginTime: new Date().toISOString()
      };

      localStorage.setItem('rs-system-session', JSON.stringify(sessionData));
      localStorage.setItem('current-user', JSON.stringify(userData));
      addLog(logId, 'æœƒè©±æ•¸æ“šå·²ä¿å­˜', 'success');

      // é©—è­‰ä¿å­˜
      const savedSession = JSON.parse(localStorage.getItem('rs-system-session'));
      const savedUser = JSON.parse(localStorage.getItem('current-user'));

      const isValid = savedSession.userId && savedSession.sessionId && savedUser.id;
      addLog(logId, isValid ? 'âœ… æœƒè©±æ•¸æ“šé©—è­‰æˆåŠŸ' : 'âŒ æœƒè©±æ•¸æ“šé©—è­‰å¤±æ•—', isValid ? 'success' : 'error');
      addLog(logId, `sessionId: ${savedSession.sessionId}`, 'info');
      addLog(logId, `éæœŸæ™‚é–“: ${new Date(savedSession.expiresAt).toLocaleString('zh-TW')}`, 'info');

      setStatus(statusId, isValid ? 'âœ… é€šé' : 'âŒ å¤±æ•—', isValid ? 'pass' : 'fail');
    }

    // æ¸¬è©¦ 3: æœƒè©±é©—è­‰é‚è¼¯
    function testSessionValidation() {
      const logId = 'test3-log';
      const statusId = 'test3-status';
      const logElement = document.getElementById(logId);
      logElement.textContent = '';
      logElement.style.display = 'block';

      addLog(logId, 'é–‹å§‹æ¸¬è©¦æœƒè©±é©—è­‰é‚è¼¯...', 'info');

      const session = localStorage.getItem('rs-system-session');
      const currentUser = localStorage.getItem('current-user');

      // å ´æ™¯ 1: ç„¡æœƒè©±
      addLog(logId, 'å ´æ™¯ 1: ç„¡æœƒè©±', 'info');
      if (!session || !currentUser) {
        addLog(logId, 'âœ… æ­£ç¢º: æœƒé‡å®šå‘åˆ° login.html', 'success');
      } else {
        // å ´æ™¯ 2: æœƒè©±å·²éæœŸ
        try {
          const sessionData = JSON.parse(session);
          addLog(logId, `å ´æ™¯ 2: æª¢æŸ¥æœƒè©±éæœŸ (éæœŸæ™‚é–“: ${new Date(sessionData.expiresAt).toLocaleString('zh-TW')})`, 'info');

          if (Date.now() > sessionData.expiresAt) {
            addLog(logId, 'âœ… æ­£ç¢º: æœƒè©±å·²éæœŸï¼Œæ‡‰é‡å®šå‘åˆ° login.html', 'success');
          } else {
            addLog(logId, `â±ï¸ æœƒè©±ä»æœ‰æ•ˆ (å‰©é¤˜æ™‚é–“: ${((sessionData.expiresAt - Date.now()) / 1000 / 60).toFixed(1)} åˆ†é˜)`, 'info');
            addLog(logId, 'âœ… æ­£ç¢º: æ‡‰å…è¨±è¨ªå• index.html', 'success');
          }

          // å ´æ™¯ 3: é©—è­‰æ•¸æ“šå®Œæ•´æ€§
          addLog(logId, 'å ´æ™¯ 3: é©—è­‰æ•¸æ“šå®Œæ•´æ€§', 'info');
          const userData = JSON.parse(currentUser);
          if (sessionData.userId && sessionData.sessionId && userData.id) {
            addLog(logId, 'âœ… æ­£ç¢º: æœƒè©±æ•¸æ“šå®Œæ•´ï¼Œå…è¨±è¨ªå•', 'success');
          } else {
            addLog(logId, 'âŒ éŒ¯èª¤: æœƒè©±æ•¸æ“šä¸å®Œæ•´ï¼Œæ‡‰é‡å®šå‘', 'error');
          }
        } catch (error) {
          addLog(logId, `âŒ éŒ¯èª¤: æœƒè©±æ•¸æ“šæ ¼å¼éŒ¯èª¤ (${error.message})`, 'error');
        }
      }

      setStatus(statusId, 'âœ… é©—è­‰å®Œæˆ', 'pass');
    }

    // æ¸¬è©¦ 4: å®Œæ•´æµç¨‹
    function testCompleteFlow() {
      const logId = 'test4-log';
      const statusId = 'test4-status';
      const logElement = document.getElementById(logId);
      logElement.textContent = '';
      logElement.style.display = 'block';

      addLog(logId, '=== å®Œæ•´æµç¨‹æ¨¡æ“¬é–‹å§‹ ===', 'info');

      // æ­¥é©Ÿ 1: æ¸…é™¤ç¾æœ‰æœƒè©±
      addLog(logId, 'æ­¥é©Ÿ 1: æ¸…é™¤ç¾æœ‰æœƒè©±...', 'info');
      localStorage.removeItem('rs-system-session');
      localStorage.removeItem('current-user');
      addLog(logId, 'âœ… æœƒè©±å·²æ¸…é™¤', 'success');

      // æ­¥é©Ÿ 2: æ¨¡æ“¬ç™»å…¥
      addLog(logId, 'æ­¥é©Ÿ 2: æ¨¡æ“¬ç™»å…¥ä¸¦ä¿å­˜æœƒè©±...', 'info');
      const currentTime = Date.now();
      const sessionTimeout = 24 * 60 * 60 * 1000;

      const sessionData = {
        userId: 'demo_user_001',
        username: 'demouser',
        sessionId: `session_${currentTime}_demo`,
        createdAt: currentTime,
        expiresAt: currentTime + sessionTimeout,
        role: 'user'
      };

      const userData = {
        id: 'demo_user_001',
        username: 'demouser',
        email: 'demo@example.com',
        role: 'user'
      };

      localStorage.setItem('rs-system-session', JSON.stringify(sessionData));
      localStorage.setItem('current-user', JSON.stringify(userData));
      addLog(logId, `âœ… æœƒè©±å·²ä¿å­˜`, 'success');
      addLog(logId, `   userId: ${sessionData.userId}`, 'info');
      addLog(logId, `   sessionId: ${sessionData.sessionId}`, 'info');

      // æ­¥é©Ÿ 3: åŸ·è¡Œ index.html çš„æœƒè©±æª¢æŸ¥é‚è¼¯
      addLog(logId, 'æ­¥é©Ÿ 3: åŸ·è¡Œ index.html çš„æœƒè©±æª¢æŸ¥é‚è¼¯...', 'info');
      
      try {
        const session = localStorage.getItem('rs-system-session');
        const currentUser = localStorage.getItem('current-user');

        if (!session || !currentUser) {
          addLog(logId, 'âŒ æœƒè©±æª¢æŸ¥å¤±æ•—: æœªæ‰¾åˆ°æœƒè©±æ•¸æ“š', 'error');
          setStatus(statusId, 'âŒ å¤±æ•—', 'fail');
          return;
        }

        const sessionData = JSON.parse(session);
        const userData = JSON.parse(currentUser);

        if (!sessionData.userId || !sessionData.sessionId || !userData.id) {
          addLog(logId, 'âŒ æœƒè©±æª¢æŸ¥å¤±æ•—: æ•¸æ“šä¸å®Œæ•´', 'error');
          setStatus(statusId, 'âŒ å¤±æ•—', 'fail');
          return;
        }

        if (sessionData.expiresAt && Date.now() > sessionData.expiresAt) {
          addLog(logId, 'âŒ æœƒè©±æª¢æŸ¥å¤±æ•—: æœƒè©±å·²éæœŸ', 'error');
          setStatus(statusId, 'âŒ å¤±æ•—', 'fail');
          return;
        }

        addLog(logId, 'âœ… æœƒè©±æª¢æŸ¥é€šé', 'success');
        addLog(logId, 'âœ… index.html ä¸æœƒé‡å®šå‘åˆ° login.html', 'success');
        addLog(logId, '=== å®Œæ•´æµç¨‹æ¨¡æ“¬æˆåŠŸ ===', 'success');
        setStatus(statusId, 'âœ… é€šé - å·²ä¿®å¾©ï¼', 'pass');
      } catch (error) {
        addLog(logId, `âŒ éŒ¯èª¤: ${error.message}`, 'error');
        setStatus(statusId, 'âŒ å¤±æ•—', 'fail');
      }
    }

    // é é¢åŠ è¼‰æ™‚çš„åˆå§‹åŒ–
    console.log('âœ… ç™»å…¥é‡å®šå‘ä¿®å¾©é©—è­‰é é¢å·²åŠ è¼‰');
    console.log('å¯ç”¨çš„æ¸¬è©¦:');
    console.log('1. testSessionStructure() - æª¢æŸ¥æœƒè©±çµæ§‹');
    console.log('2. testLoginFlow() - æ¸¬è©¦ç™»å…¥æµç¨‹');
    console.log('3. testSessionValidation() - é©—è­‰æœƒè©±é‚è¼¯');
    console.log('4. testCompleteFlow() - å®Œæ•´æµç¨‹æ¨¡æ“¬');
  </script>
</body>
</html>
