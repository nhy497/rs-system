# 系統功能測試指南

## 📋 已實現的功能清單

### 1. ✅ 用戶身份識別修復
- **狀態**: 已完成
- **修改位置**: index.html (第六步 UI 更新)
- **功能**:
  - 側邊欄現在正確顯示用戶名（從 localStorage 的 `current-user` 讀取）
  - 顯示用戶角色（👑 Creator 或 👤 用戶）
  - 根據角色自動控制「數據管理」菜單可見性

### 2. ✅ 動態統計儀表板
- **狀態**: 已完成
- **修改位置**: app.js (updateSidebarStats 函數)
- **功能**:
  - 側邊欄「今日課堂」顯示今天的記錄數（動態計算）
  - 側邊欄「學生總數」顯示所有記錄的累計學生人數（動態計算）
  - 統計頁面的數據也動態更新（不再是硬編碼零值）

### 3. ✅ 賬戶刪除功能
- **狀態**: 已完成
- **修改位置**: app.js (deleteUser 函數 + 用戶列表渲染)
- **功能**:
  - Creator 用戶可在「用戶管理」頁面刪除其他用戶
  - 無法刪除當前登入的用戶（防止誤操作）
  - 刪除時需要確認對話框
  - 刪除後頁面自動刷新

### 4. ✅ Creator 角色和權限控制
- **狀態**: 已完成
- **修改位置**: index.html + app.js
- **功能**:
  - 添加了 `isCreator()` 函數檢查用戶角色
  - 添加了 `getCurrentUser()` 函數獲取當前用戶
  - 「用戶管理」頁面只對 Creator 用戶顯示
  - 只有 Creator 才能訪問統計數據和刪除用戶

### 5. ✅ 默認 Creator 賬戶創建
- **狀態**: 已完成
- **修改位置**: login.html (初始化部分)
- **功能**:
  - 系統首次啟動時自動創建預設 Creator 賬戶
  - **用戶名**: creator
  - **密碼**: 1234
  - **角色**: creator
  - **郵箱**: creator@system.local
  - 如果賬戶已存在，不會重複創建

---

## 🧪 測試步驟

### 第一步：驗證 Creator 賬戶自動創建

1. 打開瀏覽器，訪問 `http://localhost:8000/login.html`
2. 打開開發者工具（F12）→ Application → LocalStorage
3. 查看 `users` 鍵的值，應該看到一個包含 creator 賬戶的 JSON 數組
4. **預期結果**: 
   ```json
   [
     {
       "id": "...",
       "username": "creator",
       "password": "1234",
       "email": "creator@system.local",
       "role": "creator",
       "createdAt": "2026-01-24T..."
     }
   ]
   ```

### 第二步：測試 Creator 賬戶登入

1. 在登入頁面輸入:
   - 用戶名: `creator`
   - 密碼: `1234`
2. 點擊「登入」按鈕
3. **預期結果**:
   - 頁面重定向到 index.html
   - 側邊欄左上角顯示「creator」用戶名
   - 用戶角色顯示為「👑 Creator」

### 第三步：驗證用戶身份識別修復

1. 登入成功後，查看側邊欄：
   - ✓ 用戶名顯示正確
   - ✓ 角色標籤顯示「👑 Creator」
   - ✓ 「數據管理」菜單項可見（因為是 Creator）

### 第四步：測試動態統計儀表板

1. 創建幾條課堂記錄（隨意填寫數據）
2. 檢查側邊欄統計：
   - 「今日課堂」應顯示今天創建的記錄數
   - 「學生總數」應顯示所有記錄的學生人數總和
3. 創建更多記錄後，數字應自動更新
4. **預期結果**: 統計數據為動態值，不是硬編碼的零

### 第五步：測試用戶管理和刪除功能

1. 點擊側邊欄的「用戶管理」（應該可見，因為是 Creator）
2. 頁面顯示「👥 系統用戶」卡片和「📊 系統統計」卡片
3. 創建另一個普通用戶賬戶（登出後用註冊功能）
4. 再次登入 creator 賬戶
5. 在「用戶管理」頁面應該看到：
   - 列出所有用戶
   - 普通用戶旁邊有「刪除」按鈕
   - creator 用戶（當前用戶）旁邊顯示「⚠️ 無法刪除當前用戶」
6. 點擊某個普通用戶的「刪除」按鈕
7. **預期結果**:
   - 出現確認對話框
   - 確認後用戶被刪除
   - 頁面自動刷新，該用戶消失

### 第六步：測試角色權限控制

1. 用普通用戶賬戶登入
2. 查看側邊欄：
   - ✓ 用戶名顯示正確
   - ✓ 角色標籤顯示「👤 用戶」
   - ✓ 「用戶管理」菜單項**不可見**（因為不是 Creator）
3. 即使直接訪問 `#data` 頁面，應該也無法看到用戶列表

### 第七步：測試統計數據權限

1. 用普通用戶登入，訪問「統計分析」頁面
2. 應該看到統計圖表（普通用戶可以看）
3. 「用戶管理」頁面應該被隱藏
4. 用 Creator 賬戶登入，訪問「統計分析」
5. 除了統計圖表外，還應該能訪問「用戶管理」頁面

---

## 🐛 故障排除

### 問題1：Creator 賬戶沒有被自動創建

**症狀**: 無法用 `creator/1234` 登入

**解決方案**:
1. 清空 localStorage：在控制台執行 `localStorage.clear()`
2. 重新載入頁面（會重新運行初始化代碼）
3. 再次檢查 users 鍵

### 問題2：側邊欄不顯示用戶名

**症狀**: 側邊欄顯示「未登錄」

**解決方案**:
1. 檢查 `current-user` localStorage 鍵是否存在
2. 查看瀏覽器控制台是否有錯誤信息
3. 確保 index.html 第六步的代碼已執行（檢查控制台日誌）

### 問題3：「用戶管理」菜單不出現

**症狀**: 即使以 Creator 身份登入，也看不到「用戶管理」菜單

**解決方案**:
1. 驗證 `current-user` 中的 `role` 字段值是否為 `creator`（區分大小寫）
2. 查看 app.js 中 `isCreator()` 函數是否正確
3. 檢查 `navData` 元素是否存在於 HTML 中

### 問題4：統計數據仍是零

**症狀**: 側邊欄統計仍顯示 0

**解決方案**:
1. 確保已創建課堂記錄
2. 檢查 `updateSidebarStats()` 函數是否被調用
3. 驗證 `parseRecords()` 函數返回的數據是否正確

---

## 📊 數據結構參考

### users（用戶列表）
```json
{
  "id": "用戶唯一 ID",
  "username": "用戶名",
  "password": "密碼（明文存儲，實際應加密）",
  "email": "郵箱",
  "role": "user 或 creator",
  "createdAt": "創建時間"
}
```

### current-user（當前登入用戶）
```json
{
  "id": "用戶 ID",
  "username": "用戶名",
  "email": "郵箱",
  "role": "user 或 creator",
  "loginTime": "登入時間"
}
```

### rs-system-session（會話數據）
```json
{
  "userId": "用戶 ID",
  "username": "用戶名",
  "role": "user 或 creator",
  "loginTime": "登入時間",
  "lastActivity": "最後活動時間"
}
```

---

## ✅ 完成檢查清單

在宣佈完成前，請確認以下所有項目：

- [ ] Creator 賬戶自動創建成功
- [ ] 能用 creator/1234 登入
- [ ] 側邊欄顯示正確的用戶名和角色
- [ ] 側邊欄統計數據動態更新
- [ ] Creator 可以訪問「用戶管理」
- [ ] 普通用戶無法看到「用戶管理」
- [ ] 可以成功刪除普通用戶
- [ ] 無法刪除當前登入的用戶
- [ ] 統計分析頁面數據正確
- [ ] 新建用戶時自動設置 role 為 'user'

---

**測試完成日期**: 2026 年 1 月 24 日  
**系統版本**: v2.1.1  
**測試人員**: QA Team
